<!DOCTYPE html>
<html lang="en-US">
<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
  <meta name="generator" content="Madoko, version 1.1.4" />
  <meta name="viewport" content="initial-scale=1.0" />
  <meta name="author" content="卢昱昊" />
  <title>C++学习论坛系统最终版本</title>
  <style type="text/css"  class="link">
  /*# sourceURL=madoko.css */
  
  .madoko .toc>.tocblock .tocblock .tocblock {
    margin-left: 2.25em;
  }
  .madoko .toc>.tocblock .tocblock {
    margin-left: 1.5em;
  }
  .madoko .toc-contents>.tocblock>.tocitem {
    font-weight: bold;
  }
  .madoko .toc {
    margin-top: 1em;
  }
  .madoko p.para-continue {
    margin-bottom: 0pt;
  }
  .madoko .para-block+p {
    margin-top: 0pt;
  }
  .madoko ul.para-block, .madoko ol.para-block {
    margin-top: 0pt;
    margin-bottom: 0pt;
  }
  .madoko ul.para-end, .madoko ol.para-end {
    margin-bottom: 1em;
  }
  .madoko dl {
    margin-left: 0em;
  }
  .madoko blockquote {
    font-style: italic;
  }
  .madoko a.localref {
    text-decoration: none;
  }
  .madoko a.localref:hover {
    text-decoration: underline;
  }
  .madoko .footnotes {
    font-size: smaller;
    margin-top: 2em;
  }
  .madoko .footnotes hr {
    width: 50%;
    text-align: left;
  }
  .madoko .footnote { 
    margin-left: 1em;
  }
  .madoko .footnote-before {
    margin-left: -1em;
    width: 1em;
    display: inline-block;
  }
  .madoko .align-center, .madoko .align-center>p {
    text-align: center !important;
  }
  .madoko .align-center pre {
    text-align: left;
  }
  .madoko .align-center>* {
    margin-left: auto !important;
    margin-right: auto !important;
  }
  .madoko .align-left, .madoko .align-left>p {
    text-align: left !important;
  }
  .madoko .align-left>* {
    margin-left: 0pt !important;
    margin-right: auto !important;
  }
  .madoko .align-right, .madoko .align-right>p {
    text-align: right !important;
  }
  .madoko .align-right>* {
    margin-left: auto !important;
    margin-right: 0pt !important;
  }
  .madoko .align-center>table,
  .madoko .align-left>table,
  .madoko .align-right>table {
    text-align: left !important;
  }
  .madoko .equation-before {
    float: right;
  }
  .madoko .bibitem {
    font-size: smaller;
  }
  .madoko .bibsearch {
    font-size: x-small;
    text-decoration:none;
    color: black;
    font-family: "Segoe UI Symbol", Symbola, serif;
  }
  .madoko .block, .madoko .figure, .madoko .bibitem, .madoko .equation, .madoko div.math {
    margin-top: 1ex;
    margin-bottom: 1ex;
  }
  .madoko .figure {
    padding: 0.5em;
    margin-left: 0pt;
    margin-right: 0pt;
  }
  .madoko .hidden {
    display: none;
  }
  .madoko .invisible {
    visibility: hidden;
  }
  .madoko.preview .invisible {
    visibility: visible;
    opacity: 0.5;
  }
  .madoko code.code, .madoko span.code {
    white-space: pre-wrap;
  }
  .madoko hr, hr.madoko {
    border: none;
    border-bottom: black solid 1px;
    margin-bottom: 0.5ex;
  }
  .madoko .framed>*:first-child {
    margin-top: 0pt;
  }
  .madoko .framed>*:last-child {
    margin-bottom: 0pt;
  }
  .madoko ul.list-style-type-dash {
      list-style-type: none !important;
  }
  .madoko ul.list-style-type-dash > li:before {
      content: "\2013"; 
      position: absolute;
      margin-left: -1em; 
  }
  .madoko table.madoko {
    border-collapse: collapse;
  }
  .madoko td, .madoko th {
    padding: 0ex 0.5ex;
    margin: 0pt;
    vertical-align: top;
  }
  .madoko .cell-border-left {
    border-left: 1px solid black;
  }
  .madoko .cell-border-right {
    border-right: 1px solid black;
  }
  .madoko thead>tr:first-child>.cell-line,
  .madoko tbody:first-child>tr:first-child>.cell-line {
    border-top: 1px solid black;
    border-bottom: none;
  }
  .madoko .cell-line, .madoko .cell-double-line {
    border-bottom: 1px solid black;
    border-top: none;
  }
  .madoko .cell-double-line {
    border-top: 1px solid black;
    padding-top: 1.5px !important;
  }
  .madoko .input-mathpre .MathJax_Display {
    text-align: left !important;
  }
  .madoko div.input-mathpre {
    text-align: left;
    margin-top: 1.5ex;
    margin-bottom: 1ex;
  }
  .madoko .math-rendering {
    text-align: left;
    white-space: pre;
    color: gray;
  }
  .madoko .mathdisplay {
    text-align: center;
  }
  .madoko .pretty table {
    border-collapse: collapse;
  }
  .madoko .pretty td {
    padding: 0em;
  }
  .madoko .pretty td.empty {
    min-width: 1.5ex;
  }
  .madoko .pretty td.expander {
    width: 100em;
  }
  body.madoko, .madoko .serif {
    font-family: Cambria,"Times New Roman","Liberation Serif","Times",serif;
  }
  .madoko .sans-serif {
    font-family: "Calibri", "Optima", sans-serif;
  }
  .madoko .symbol {
    font-family: "Segoe UI Symbol", Symbola, serif;
  }
  body.madoko {  
    -webkit-text-size-adjust: 100%;       
    text-rendering: optimizeLegibility;
  }
  body.madoko {
    max-width: 88ex; 
    margin: 1em auto;
    padding: 0em 2em;  
  }
  body.preview.madoko {
    padding: 0em 1em;
  }
  .madoko p {
    text-align: justify;
  }
  .madoko h1, .madoko h2, .madoko h3, .madoko h4 { 
    margin-top: 1.22em; 
    margin-bottom: 1ex;
  }
  .madoko h1+p, .madoko h2+p, .madoko h3+p, .madoko h4+p, .madoko h5+p  { 
    margin-top: 1ex;    
  }
  .madoko h5, .madoko h6 { 
    margin-top: 1ex;
    font-size: 1em;
  }
  .madoko h5 { 
    margin-bottom: 0.5ex;
  }
  .madoko h5 + p {
    margin-top: 0.5ex;
  }
  .madoko h6 { 
    margin-bottom: 0pt;
  }
  .madoko h6 + p {
    margin-top: 0pt;
  }
  .madoko pre, .madoko code, .madoko kbd, .madoko samp, .madoko tt, 
  .madoko .monospace, .madoko .token-indent, .madoko .reveal pre, .madoko .reveal code, .madoko .email {
    font-family: Consolas,"Andale Mono WT","Andale Mono",Lucida Console,Monaco,monospace,monospace;
    font-size: 0.85em;
  }
  .madoko pre code, .madoko .token-indent {
    font-size: 0.95em;
  }
  .madoko pre code {
    font-family: inherit !important;
  }
  .madoko ol.linenums li {
    background-color: white;
    list-style-type: decimal;
  }
  .madoko .remote {
    background-color: #F0FFF0;
  }
  .madoko .remote + * {
    margin-top: 0pt;
  }
  @media print {
    body.madoko {
      font-size: 10pt;
    }
    @page {
      margin: 1in 1.5in;
    }
  }
  @media only screen and (max-device-width:1024px) {
    body.madoko {
      padding: 0em 0.5em;    
    }
    .madoko li {
      text-align: left;
    }
  }
  
    </style>
  
  </head>
<body class="madoko">

<div class="body madoko" style="line-adjust:0">

<div class="titleblock align-center para-block" data-line="6" style="text-align:center;line-adjust:0">
<div class="titleheader align-center" data-line="6" style="text-align:center;line-adjust:0">
<div class="title para-block" data-line="6" style="font-size:xx-large;font-weight:bold;margin-bottom:0.5ex;line-adjust:0"><span data-line="6"></span>C++学习论坛系统最终版本</div></div>
<div class="authors align-center" data-line="11" style="text-align:center;width:80%;line-adjust:0"><table class="authorrow columns block" data-line="11" style="margin-top:2ex;width:100%;line-adjust:0">
<tbody><tr><td class="author column" data-line="11" style="text-align:center;line-adjust:0">
<div class="authorname" data-line="11" style="font-size:large;line-adjust:0"><span data-line="11"></span>卢昱昊</div></td></tr></tbody></table></div></div><span data-line="7"></span>
<nav class="toc toc-contents"><h2 id="sec-contents" class="clearnum h1 heading-contents" data-heading-depth="1" style="display:block">Contents</h2>
<div class="tocblock tocblock1">
<div class="tocitem tocitem1" data-toc-target-elem="h1" data-toc-target="sec-feature" data-toc-depth="1" data-toc-line="[1]{.heading-label}.&#8194;Feature" style="toctarget:sec-feature"><a href="#sec-feature" class="localref"><span class="heading-label">1</span>.&#8194;Feature</a></div>
<div class="tocitem tocitem1" data-toc-target-elem="h1" data-toc-target="section" data-toc-depth="1" data-toc-line="[2]{.heading-label}.&#8194;\u5F00\u53D1\u73AF\u5883" style="toctarget:section"><a href="#section" class="localref"><span class="heading-label">2</span>.&#8194;开发环境</a></div>
<div class="tocitem tocitem1" data-toc-target-elem="h1" data-toc-target="section" data-toc-depth="1" data-toc-line="[3]{.heading-label}.&#8194;\u529F\u80FD\u5B9E\u73B0" style="toctarget:section"><a href="#section" class="localref"><span class="heading-label">3</span>.&#8194;功能实现</a></div>
<div class="tocblock tocblock2">
<div class="tocitem tocitem2" data-toc-target-elem="h2" data-toc-target="section" data-toc-depth="2" data-toc-line="[3.1]{.heading-label}.&#8194;\u57FA\u672C\u5355\u4F4D\u5B9A\u4E49" style="toctarget:section"><a href="#section" class="localref"><span class="heading-label">3.1</span>.&#8194;基本单位定义</a></div>
<div class="tocblock tocblock3">
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="sec-uesrinfo" data-toc-depth="3" data-toc-line="[3.1.1]{.heading-label}.&#8194;\u7528\u6237(uesrinfo)" style="toctarget:sec-uesrinfo"><a href="#sec-uesrinfo" class="localref"><span class="heading-label">3.1.1</span>.&#8194;用户(uesrinfo)</a></div>
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="sec-post" data-toc-depth="3" data-toc-line="[3.1.2]{.heading-label}.&#8194;\u5E16\u5B50(post)" style="toctarget:sec-post"><a href="#sec-post" class="localref"><span class="heading-label">3.1.2</span>.&#8194;帖子(post)</a></div>
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="pagelet" data-toc-depth="3" data-toc-line="[3.1.3]{.heading-label}.&#8194;\u8D34\u9875(pagelet)" style="toctarget:pagelet"><a href="#pagelet" class="localref"><span class="heading-label">3.1.3</span>.&#8194;贴页(pagelet)</a></div>
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="sec-board" data-toc-depth="3" data-toc-line="[3.1.4]{.heading-label}.&#8194;\u7248\u5757(board)" style="toctarget:sec-board"><a href="#sec-board" class="localref"><span class="heading-label">3.1.4</span>.&#8194;版块(board)</a></div>
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="section" data-toc-depth="3" data-toc-line="[3.1.5]{.heading-label}.&#8194;\u5BA2\u6237\u7AEF" style="toctarget:section"><a href="#section" class="localref"><span class="heading-label">3.1.5</span>.&#8194;客户端</a></div>
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="section" data-toc-depth="3" data-toc-line="[3.1.6]{.heading-label}.&#8194;\u670D\u52A1\u7AEF" style="toctarget:section"><a href="#section" class="localref"><span class="heading-label">3.1.6</span>.&#8194;服务端</a></div></div>
<div class="tocitem tocitem2" data-toc-target-elem="h2" data-toc-target="section" data-toc-depth="2" data-toc-line="[3.2]{.heading-label}.&#8194;\u57FA\u672C\u529F\u80FD" style="toctarget:section"><a href="#section" class="localref"><span class="heading-label">3.2</span>.&#8194;基本功能</a></div>
<div class="tocblock tocblock3">
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="section" data-toc-depth="3" data-toc-line="[3.2.1]{.heading-label}.&#8194;\u7528\u6237\u6743\u9650" style="toctarget:section"><a href="#section" class="localref"><span class="heading-label">3.2.1</span>.&#8194;用户权限</a></div>
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="section" data-toc-depth="3" data-toc-line="[3.2.2]{.heading-label}.&#8194;\u6CE8\u518C" style="toctarget:section"><a href="#section" class="localref"><span class="heading-label">3.2.2</span>.&#8194;注册</a></div>
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="section" data-toc-depth="3" data-toc-line="[3.2.3]{.heading-label}.&#8194;\u767B\u5F55" style="toctarget:section"><a href="#section" class="localref"><span class="heading-label">3.2.3</span>.&#8194;登录</a></div>
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="section" data-toc-depth="3" data-toc-line="[3.2.4]{.heading-label}.&#8194;\u6E38\u5BA2\u767B\u5F55" style="toctarget:section"><a href="#section" class="localref"><span class="heading-label">3.2.4</span>.&#8194;游客登录</a></div>
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="section" data-toc-depth="3" data-toc-line="[3.2.5]{.heading-label}.&#8194;\u9875" style="toctarget:section"><a href="#section" class="localref"><span class="heading-label">3.2.5</span>.&#8194;页</a></div>
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="section" data-toc-depth="3" data-toc-line="[3.2.6]{.heading-label}.&#8194;\u4E3B\u9875" style="toctarget:section"><a href="#section" class="localref"><span class="heading-label">3.2.6</span>.&#8194;主页</a></div>
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="section" data-toc-depth="3" data-toc-line="[3.2.7]{.heading-label}.&#8194;\u6CE8\u9500\u64CD\u4F5C" style="toctarget:section"><a href="#section" class="localref"><span class="heading-label">3.2.7</span>.&#8194;注销操作</a></div>
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="section" data-toc-depth="3" data-toc-line="[3.2.8]{.heading-label}.&#8194;\u67E5\u770B\u4E2A\u4EBA\u4FE1\u606F" style="toctarget:section"><a href="#section" class="localref"><span class="heading-label">3.2.8</span>.&#8194;查看个人信息</a></div>
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="section" data-toc-depth="3" data-toc-line="[3.2.9]{.heading-label}.&#8194;\u4FEE\u6539\u4E2A\u4EBA\u4FE1\u606F" style="toctarget:section"><a href="#section" class="localref"><span class="heading-label">3.2.9</span>.&#8194;修改个人信息</a></div>
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="section" data-toc-depth="3" data-toc-line="[3.2.10]{.heading-label}.&#8194;\u8BBA\u575B\u7248\u5757" style="toctarget:section"><a href="#section" class="localref"><span class="heading-label">3.2.10</span>.&#8194;论坛版块</a></div>
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="section" data-toc-depth="3" data-toc-line="[3.2.11]{.heading-label}.&#8194;\u6D4F\u89C8\u5E16\u5B50" style="toctarget:section"><a href="#section" class="localref"><span class="heading-label">3.2.11</span>.&#8194;浏览帖子</a></div>
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="section" data-toc-depth="3" data-toc-line="[3.2.12]{.heading-label}.&#8194;\u53D1\u9001\u5E16\u5B50" style="toctarget:section"><a href="#section" class="localref"><span class="heading-label">3.2.12</span>.&#8194;发送帖子</a></div>
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="section" data-toc-depth="3" data-toc-line="[3.2.13]{.heading-label}.&#8194;\u5220\u9664\u5E16\u5B50" style="toctarget:section"><a href="#section" class="localref"><span class="heading-label">3.2.13</span>.&#8194;删除帖子</a></div>
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="section" data-toc-depth="3" data-toc-line="[3.2.14]{.heading-label}.&#8194;\u6D4F\u89C8\u5E16\u5B50" style="toctarget:section"><a href="#section" class="localref"><span class="heading-label">3.2.14</span>.&#8194;浏览帖子</a></div>
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="section" data-toc-depth="3" data-toc-line="[3.2.15]{.heading-label}.&#8194;\u5E16\u5B50" style="toctarget:section"><a href="#section" class="localref"><span class="heading-label">3.2.15</span>.&#8194;帖子</a></div>
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="section" data-toc-depth="3" data-toc-line="[3.2.16]{.heading-label}.&#8194;\u8BC4\u8BBA" style="toctarget:section"><a href="#section" class="localref"><span class="heading-label">3.2.16</span>.&#8194;评论</a></div>
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="section" data-toc-depth="3" data-toc-line="[3.2.17]{.heading-label}.&#8194;\u67E5\u770B\u7528\u6237\u5217\u8868" style="toctarget:section"><a href="#section" class="localref"><span class="heading-label">3.2.17</span>.&#8194;查看用户列表</a></div></div>
<div class="tocitem tocitem2" data-toc-target-elem="h2" data-toc-target="section" data-toc-depth="2" data-toc-line="[3.3]{.heading-label}.&#8194;\u7279\u8272\u529F\u80FD" style="toctarget:section"><a href="#section" class="localref"><span class="heading-label">3.3</span>.&#8194;特色功能</a></div>
<div class="tocblock tocblock3">
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="regcheck" data-toc-depth="3" data-toc-line="[3.3.1]{.heading-label}.&#8194;\u6CE8\u518C\u68C0\u67E5" style="toctarget:regcheck"><a href="#regcheck" class="localref"><span class="heading-label">3.3.1</span>.&#8194;注册检查</a></div>
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="guestin" data-toc-depth="3" data-toc-line="[3.3.2]{.heading-label}.&#8194;\u6E38\u5BA2\u767B\u5F55\u65B9\u5F0F" style="toctarget:guestin"><a href="#guestin" class="localref"><span class="heading-label">3.3.2</span>.&#8194;游客登录方式</a></div>
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="fatherpage" data-toc-depth="3" data-toc-line="[3.3.3]{.heading-label}.&#8194;\u9875" style="toctarget:fatherpage"><a href="#fatherpage" class="localref"><span class="heading-label">3.3.3</span>.&#8194;页</a></div>
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="section" data-toc-depth="3" data-toc-line="[3.3.4]{.heading-label}.&#8194;\u4EFF\u6D4F\u89C8\u5668\u524D\u7AEF" style="toctarget:section"><a href="#section" class="localref"><span class="heading-label">3.3.4</span>.&#8194;仿浏览器前端</a></div>
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="section" data-toc-depth="3" data-toc-line="[3.3.5]{.heading-label}.&#8194;\u521B\u5EFA\u7248\u5757" style="toctarget:section"><a href="#section" class="localref"><span class="heading-label">3.3.5</span>.&#8194;创建版块</a></div>
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="levelup" data-toc-depth="3" data-toc-line="[3.3.6]{.heading-label}.&#8194;\u5347\u7EA7\u6743\u9650" style="toctarget:levelup"><a href="#levelup" class="localref"><span class="heading-label">3.3.6</span>.&#8194;升级权限</a></div>
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="section" data-toc-depth="3" data-toc-line="[3.3.7]{.heading-label}.&#8194;\u5237\u65B0\u754C\u9762" style="toctarget:section"><a href="#section" class="localref"><span class="heading-label">3.3.7</span>.&#8194;刷新界面</a></div>
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="section" data-toc-depth="3" data-toc-line="[3.3.8]{.heading-label}.&#8194;\u591A\u7528\u6237" style="toctarget:section"><a href="#section" class="localref"><span class="heading-label">3.3.8</span>.&#8194;多用户</a></div></div></div>
<div class="tocitem tocitem1" data-toc-target-elem="h1" data-toc-target="section" data-toc-depth="1" data-toc-line="[4]{.heading-label}.&#8194;\u8BBE\u8BA1\u6A21\u5F0F\u4F18\u70B9\u53CA\u5176\u4F53\u73B0" style="toctarget:section"><a href="#section" class="localref"><span class="heading-label">4</span>.&#8194;设计模式优点及其体现</a></div>
<div class="tocblock tocblock2">
<div class="tocitem tocitem2" data-toc-target-elem="h2" data-toc-target="oop" data-toc-depth="2" data-toc-line="[4.1]{.heading-label}.&#8194;\u9762\u5411\u5BF9\u8C61\u7279\u5F81\u4F53\u73B0" style="toctarget:oop"><a href="#oop" class="localref"><span class="heading-label">4.1</span>.&#8194;面向对象特征体现</a></div>
<div class="tocblock tocblock3">
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="section" data-toc-depth="3" data-toc-line="[4.1.1]{.heading-label}.&#8194;\u5C01\u88C5\u6027" style="toctarget:section"><a href="#section" class="localref"><span class="heading-label">4.1.1</span>.&#8194;封装性</a></div>
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="section" data-toc-depth="3" data-toc-line="[4.1.2]{.heading-label}.&#8194;\u7EE7\u627F" style="toctarget:section"><a href="#section" class="localref"><span class="heading-label">4.1.2</span>.&#8194;继承</a></div>
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="section" data-toc-depth="3" data-toc-line="[4.1.3]{.heading-label}.&#8194;\u591A\u6001" style="toctarget:section"><a href="#section" class="localref"><span class="heading-label">4.1.3</span>.&#8194;多态</a></div></div>
<div class="tocitem tocitem2" data-toc-target-elem="h2" data-toc-target="sec-cs" data-toc-depth="2" data-toc-line="[4.2]{.heading-label}.&#8194;C/S\u67B6\u6784" style="toctarget:sec-cs"><a href="#sec-cs" class="localref"><span class="heading-label">4.2</span>.&#8194;C/S架构</a></div>
<div class="tocblock tocblock3">
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="section" data-toc-depth="3" data-toc-line="[4.2.1]{.heading-label}.&#8194;\u901A\u4FE1\u5B9E\u73B0" style="toctarget:section"><a href="#section" class="localref"><span class="heading-label">4.2.1</span>.&#8194;通信实现</a></div>
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="answer" data-toc-depth="3" data-toc-line="[4.2.2]{.heading-label}.&#8194;\u901A\u4FE1\u683C\u5F0F" style="toctarget:answer"><a href="#answer" class="localref"><span class="heading-label">4.2.2</span>.&#8194;通信格式</a></div>
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="section" data-toc-depth="3" data-toc-line="[4.2.3]{.heading-label}.&#8194;\u591A\u7528\u6237\u5B9E\u73B0" style="toctarget:section"><a href="#section" class="localref"><span class="heading-label">4.2.3</span>.&#8194;多用户实现</a></div></div>
<div class="tocitem tocitem2" data-toc-target-elem="h2" data-toc-target="section" data-toc-depth="2" data-toc-line="[4.3]{.heading-label}.&#8194;\u5355\u4F8B\u6A21\u5F0F" style="toctarget:section"><a href="#section" class="localref"><span class="heading-label">4.3</span>.&#8194;单例模式</a></div>
<div class="tocblock tocblock3">
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="sec--" data-toc-depth="3" data-toc-line="[4.3.1]{.heading-label}.&#8194;\u5355\u4F8B\u6A21\u5F0F\u7684\u5B9E\u73B0\u6A21\u578B:" style="toctarget:sec--"><a href="#sec--" class="localref"><span class="heading-label">4.3.1</span>.&#8194;单例模式的实现模型:</a></div></div>
<div class="tocitem tocitem2" data-toc-target-elem="h2" data-toc-target="sec-sessioncookie" data-toc-depth="2" data-toc-line="[4.4]{.heading-label}.&#8194;session/cookie\u673A\u5236" style="toctarget:sec-sessioncookie"><a href="#sec-sessioncookie" class="localref"><span class="heading-label">4.4</span>.&#8194;session/cookie机制</a></div>
<div class="tocblock tocblock3">
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="sec--" data-toc-depth="3" data-toc-line="[4.4.1]{.heading-label}.&#8194;\u4F7F\u7528\u7406\u7531:" style="toctarget:sec--"><a href="#sec--" class="localref"><span class="heading-label">4.4.1</span>.&#8194;使用理由:</a></div>
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="section" data-toc-depth="3" data-toc-line="[4.4.2]{.heading-label}.&#8194;\u5B9E\u73B0\u673A\u5236\u4E0E\u4F18\u70B9" style="toctarget:section"><a href="#section" class="localref"><span class="heading-label">4.4.2</span>.&#8194;实现机制与优点</a></div></div>
<div class="tocitem tocitem2" data-toc-target-elem="h2" data-toc-target="database" data-toc-depth="2" data-toc-line="[4.5]{.heading-label}.&#8194;\u78C1\u76D8\u6570\u636E\u5E93/\u5185\u5B58\u6570\u636E\u5E93\u6A21\u578B" style="toctarget:database"><a href="#database" class="localref"><span class="heading-label">4.5</span>.&#8194;磁盘数据库/内存数据库模型</a></div></div>
<div class="tocitem tocitem1" data-toc-target-elem="h1" data-toc-target="section" data-toc-depth="1" data-toc-line="[5]{.heading-label}.&#8194;\u5177\u4F53\u5B9E\u73B0" style="toctarget:section"><a href="#section" class="localref"><span class="heading-label">5</span>.&#8194;具体实现</a></div>
<div class="tocblock tocblock2">
<div class="tocitem tocitem2" data-toc-target-elem="h2" data-toc-target="datastruct" data-toc-depth="2" data-toc-line="[5.1]{.heading-label}.&#8194;\u6570\u636E\u7ED3\u6784" style="toctarget:datastruct"><a href="#datastruct" class="localref"><span class="heading-label">5.1</span>.&#8194;数据结构</a></div>
<div class="tocblock tocblock3">
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="section" data-toc-depth="3" data-toc-line="[5.1.1]{.heading-label}.&#8194;\u76F8\u5173\u6587\u4EF6" style="toctarget:section"><a href="#section" class="localref"><span class="heading-label">5.1.1</span>.&#8194;相关文件</a></div>
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="sec-userinfo-" data-toc-depth="3" data-toc-line="[5.1.2]{.heading-label}.&#8194;userinfo \u7528\u6237\u4FE1\u606F\u7C7B" style="toctarget:sec-userinfo-"><a href="#sec-userinfo-" class="localref"><span class="heading-label">5.1.2</span>.&#8194;userinfo 用户信息类</a></div>
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="sec-post-" data-toc-depth="3" data-toc-line="[5.1.3]{.heading-label}.&#8194;post \u5E16\u5B50\u7C7B" style="toctarget:sec-post-"><a href="#sec-post-" class="localref"><span class="heading-label">5.1.3</span>.&#8194;post 帖子类</a></div>
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="sec-pagelet-" data-toc-depth="3" data-toc-line="[5.1.4]{.heading-label}.&#8194;pagelet \u8D34\u9875\u7C7B" style="toctarget:sec-pagelet-"><a href="#sec-pagelet-" class="localref"><span class="heading-label">5.1.4</span>.&#8194;pagelet 贴页类</a></div>
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="sec-board" data-toc-depth="3" data-toc-line="[5.1.5]{.heading-label}.&#8194;board" style="toctarget:sec-board"><a href="#sec-board" class="localref"><span class="heading-label">5.1.5</span>.&#8194;board</a></div></div>
<div class="tocitem tocitem2" data-toc-target-elem="h2" data-toc-target="section" data-toc-depth="2" data-toc-line="[5.2]{.heading-label}.&#8194;\u5BA2\u6237\u7AEF" style="toctarget:section"><a href="#section" class="localref"><span class="heading-label">5.2</span>.&#8194;客户端</a></div>
<div class="tocblock tocblock3">
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="section" data-toc-depth="3" data-toc-line="[5.2.1]{.heading-label}.&#8194;\u524D\u7AEF" style="toctarget:section"><a href="#section" class="localref"><span class="heading-label">5.2.1</span>.&#8194;前端</a></div>
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="front" data-toc-depth="3" data-toc-line="[5.2.2]{.heading-label}.&#8194;\u524D\u7AEF\u7684\u7EE7\u627F\u4E0E\u591A\u6001" style="toctarget:front"><a href="#front" class="localref"><span class="heading-label">5.2.2</span>.&#8194;前端的继承与多态</a></div>
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="section" data-toc-depth="3" data-toc-line="[5.2.3]{.heading-label}.&#8194;\u524D\u7AEF\u7C7B\u7528\u6237\u53CB\u597D\u4F53\u73B0" style="toctarget:section"><a href="#section" class="localref"><span class="heading-label">5.2.3</span>.&#8194;前端类用户友好体现</a></div>
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="sec-client" data-toc-depth="3" data-toc-line="[5.2.4]{.heading-label}.&#8194;client\u63A7\u5236\u7C7B\u5B9E\u73B0" style="toctarget:sec-client"><a href="#sec-client" class="localref"><span class="heading-label">5.2.4</span>.&#8194;client控制类实现</a></div></div>
<div class="tocitem tocitem2" data-toc-target-elem="h2" data-toc-target="section" data-toc-depth="2" data-toc-line="[5.3]{.heading-label}.&#8194;\u670D\u52A1\u7AEF" style="toctarget:section"><a href="#section" class="localref"><span class="heading-label">5.3</span>.&#8194;服务端</a></div>
<div class="tocblock tocblock3">
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="section" data-toc-depth="3" data-toc-line="[5.3.1]{.heading-label}.&#8194;\u6570\u636E\u5E93" style="toctarget:section"><a href="#section" class="localref"><span class="heading-label">5.3.1</span>.&#8194;数据库</a></div>
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="section" data-toc-depth="3" data-toc-line="[5.3.2]{.heading-label}.&#8194;\u670D\u52A1\u7AEF\u7A97\u53E3" style="toctarget:section"><a href="#section" class="localref"><span class="heading-label">5.3.2</span>.&#8194;服务端窗口</a></div>
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="sec-cookiesession" data-toc-depth="3" data-toc-line="[5.3.3]{.heading-label}.&#8194;cookie/session" style="toctarget:sec-cookiesession"><a href="#sec-cookiesession" class="localref"><span class="heading-label">5.3.3</span>.&#8194;cookie/session</a></div>
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="section" data-toc-depth="3" data-toc-line="[5.3.4]{.heading-label}.&#8194;\u670D\u52A1\u5668\u63A5\u6536\u5E94\u7B54\u8BF7\u6C42" style="toctarget:section"><a href="#section" class="localref"><span class="heading-label">5.3.4</span>.&#8194;服务器接收应答请求</a></div></div></div>
<div class="tocitem tocitem1" data-toc-target-elem="h1" data-toc-target="section" data-toc-depth="1" data-toc-line="[6]{.heading-label}.&#8194;\u4EA7\u54C1\u8FED\u4EE3" style="toctarget:section"><a href="#section" class="localref"><span class="heading-label">6</span>.&#8194;产品迭代</a></div>
<div class="tocblock tocblock2">
<div class="tocitem tocitem2" data-toc-target-elem="h2" data-toc-target="section" data-toc-depth="2" data-toc-line="[6.1]{.heading-label}.&#8194;\u7B2C\u4E00\u4EE3" style="toctarget:section"><a href="#section" class="localref"><span class="heading-label">6.1</span>.&#8194;第一代</a></div>
<div class="tocitem tocitem2" data-toc-target-elem="h2" data-toc-target="section" data-toc-depth="2" data-toc-line="[6.2]{.heading-label}.&#8194;\u7B2C\u4E8C\u4EE3" style="toctarget:section"><a href="#section" class="localref"><span class="heading-label">6.2</span>.&#8194;第二代</a></div>
<div class="tocitem tocitem2" data-toc-target-elem="h2" data-toc-target="section" data-toc-depth="2" data-toc-line="[6.3]{.heading-label}.&#8194;\u6700\u7EC8\u7248" style="toctarget:section"><a href="#section" class="localref"><span class="heading-label">6.3</span>.&#8194;最终版</a></div></div>
<div class="tocitem tocitem1" data-toc-target-elem="h1" data-toc-target="section" data-toc-depth="1" data-toc-line="[7]{.heading-label}.&#8194;\u611F\u609F" style="toctarget:section"><a href="#section" class="localref"><span class="heading-label">7</span>.&#8194;感悟</a></div></div></nav><h2 id="sec-feature" class="h1" data-line="9" data-heading-depth="1" style="display:block"><span data-line="9"></span><span class="heading-before"><span class="heading-label">1</span>.&#8194;</span><span data-line="9"></span>Feature</h2>
<ol class="ol compact" data-line="10">
<li class="li ol-li compact-li" data-line="10"><span data-line="10"></span>采用C++面向对象编程,并充分发扬了面向对象编程的诸多优势,见<span data-line="10"></span><a href="#oop" title="4.1.&#8194;面向对象特征体现" class="localref" style="target-element:h2"><span class="heading-label">4.1</span></a><span data-line="10"></span>
</li>
<li class="li ol-li compact-li" data-line="11"><span data-line="11"></span>实现了用户登录,匿名登录,注册,注销,查看个人信息,修改个人信息,刷新界面,浏览帖子,访问帖子,删帖,跟帖,版主权限修改,用户管理等诸多功能
</li>
<li class="li ol-li compact-li" data-line="12"><span data-line="12"></span>采用MVC设计模式,实现了客户端/服务器(C/S)处理模型
</li>
<li class="li ol-li compact-li" data-line="13"><span data-line="13"></span>server为服务程序,client为客户端程序,在本地模拟,通过<span data-line="13"></span><code class="code code1">tcpsocket</code><span data-line="13"></span>进行端口通信.<span data-line="13"></span><strong class="strong-star2">支持多用户并发执行所有２中提到的功能</strong><span data-line="13"></span>
</li>
<li class="li ol-li compact-li" data-line="14"><span data-line="14"></span>引入cookie/session机制,极大地提高了请求的安全性,提高了系统的可用性
</li>
<li class="li ol-li compact-li" data-line="15"><span data-line="15"></span><strong class="strong-star2">仿浏览器式GUI,操作便捷,交互友好</strong><span data-line="15"></span>
</li>
<li class="li ol-li compact-li" data-line="16"><span data-line="16"></span>同时<span data-line="16"></span><strong class="strong-star2">采用磁盘数据库</strong><span data-line="16"></span>与<span data-line="16"></span><strong class="strong-star2">内存数据库</strong><span data-line="16"></span>,同时保证数据存储的安全性与访问的高效性
</li></ol>
<h2 id="section" class="h1" data-line="18" data-heading-depth="1" style="display:block"><span data-line="18"></span><span class="heading-before"><span class="heading-label">2</span>.&#8194;</span><span data-line="18"></span>开发环境</h2>
<ul class="ul list-star compact" data-line="19">
<li class="li ul-li list-star-li compact-li" data-line="19"><span data-line="19"></span>Ubuntu18.04
</li>
<li class="li ul-li list-star-li compact-li" data-line="20"><span data-line="20"></span>QT 5.9
</li></ul>
<h2 id="section" class="h1" data-line="22" data-heading-depth="1" style="display:block"><span data-line="22"></span><span class="heading-before"><span class="heading-label">3</span>.&#8194;</span><span data-line="22"></span>功能实现</h2><h3 id="section" class="h2" data-line="24" data-heading-depth="2" style="display:block"><span data-line="24"></span><span class="heading-before"><span class="heading-label">3.1</span>.&#8194;</span><span data-line="24"></span>基本单位定义</h3><h4 id="sec-uesrinfo" class="h3" data-line="26" data-heading-depth="3" style="display:block"><span data-line="26"></span><span class="heading-before"><span class="heading-label">3.1.1</span>.&#8194;</span><span data-line="26"></span>用户(uesrinfo)</h4>
<p class="p noindent" data-line="28"><span data-line="28"></span>一个操作个体,具有用户id,密码,权限,email等个人信息,是请求的基本单位.
</p>
<p class="p indent" data-line="30"><span data-line="30"></span>每次用户登录,服务器都将在<span data-line="30"></span><em class="em-star1">在线用户队列</em><span data-line="30"></span>中给用户生成分配session,并返回cookie到本地作为访问服务器的凭证,确保数据访问的安全性
</p><h4 id="sec-post" class="h3" data-line="32" data-heading-depth="3" style="display:block"><span data-line="32"></span><span class="heading-before"><span class="heading-label">3.1.2</span>.&#8194;</span><span data-line="32"></span>帖子(post)</h4>
<p class="p noindent" data-line="34"><span data-line="34"></span>专指一个<span data-line="34"></span><strong class="strong-star2">楼层</strong><span data-line="34"></span>,包括帖子id,贴页id(见<span data-line="34"></span><a href="#pagelet" title="3.1.3.&#8194;贴页(pagelet)" class="localref" style="target-element:h3"><span class="heading-label">3.1.3</span></a><span data-line="34"></span>),正文,发帖者,赞数,踩数等信息
</p><h4 id="pagelet" class="h3" data-line="36" data-heading-depth="3" style="display:block"><span data-line="36"></span><span class="heading-before"><span class="heading-label">3.1.3</span>.&#8194;</span><span data-line="36"></span>贴页(pagelet)</h4>
<p class="p noindent" data-line="38"><span data-line="38"></span>一个<span data-line="38"></span><strong class="strong-star2">贴页</strong><span data-line="38"></span>里有许多许多帖子,<span data-line="38"></span><strong class="strong-star2">贴页</strong><span data-line="38"></span>相当于一个问题,一个贴页包括贴页id,标题,发起者,所属版块等信息.
</p>
<p class="p indent" data-line="40"><span data-line="40"></span>一个<span data-line="40"></span><strong class="strong-star2">贴页在创建时必须要同时发布第一条帖子</strong><span data-line="40"></span>,发帖者即为我们常说的楼主,第一条帖子内容为<span data-line="40"></span><em class="em-star1">贴页标题的补充解释内容</em><span data-line="40"></span>.
</p><h4 id="sec-board" class="h3" data-line="42" data-heading-depth="3" style="display:block"><span data-line="42"></span><span class="heading-before"><span class="heading-label">3.1.4</span>.&#8194;</span><span data-line="42"></span>版块(board)</h4>
<p class="p noindent" data-line="44"><span data-line="44"></span>一个版块内有许多的<span data-line="44"></span><strong class="strong-star2">贴页</strong><span data-line="44"></span>,版块包括版块名,版主id.关于版主,有以下两点限制:
1. 一个版块只有一个版主
2. 一个用户只能为至多一个版块的版主
</p><h4 id="section" class="h3" data-line="48" data-heading-depth="3" style="display:block"><span data-line="48"></span><span class="heading-before"><span class="heading-label">3.1.5</span>.&#8194;</span><span data-line="48"></span>客户端</h4>
<p class="p noindent" data-line="50"><span data-line="50"></span>客户端是与服务端建立tcpsocket连接的基本单位.客户端类<span data-line="50"></span><code class="code code1">client</code><span data-line="50"></span>采用单例模式,保证一次客户端软件打开只创建一个客户端类,只创建一次连接.
</p>
<p class="p indent" data-line="52"><span data-line="52"></span>一台机器上可以运行多个客户端
</p>
<p class="p indent" data-line="54"><span data-line="54"></span>客户端类<span data-line="54"></span><code class="code code1">client</code><span data-line="54"></span>主要负责:
        <span data-line="55"></span><em class="em-star1"> 创建链接: 连接服务端
        </em><span data-line="56"></span> 中间层: 所有前端涉及数据请求操作,统一交由客户端接口与服务端进行交互
        <span data-line="57"></span><em class="em-star1"> 解析/编码请求: 利用json作为数据与服务端交互,对收到的二进制串进行json解析,对发送的数据编码为json. 
        </em><span data-line="58"></span> 存储本地数据:如cookie,用户信息等
</p>
<blockquote data-line="61">

<p class="p noindent" data-line="61"><span data-line="61"></span>注:注销时重启客户端
</p></blockquote><h4 id="section" class="h3" data-line="63" data-heading-depth="3" style="display:block"><span data-line="63"></span><span class="heading-before"><span class="heading-label">3.1.6</span>.&#8194;</span><span data-line="63"></span>服务端</h4>
<p class="p noindent" data-line="64"><span data-line="64"></span>服务端只需要运行一个,服务端类<span data-line="64"></span><code class="code code1">server</code><span data-line="64"></span>采用单例模式创建,保证一次运行只需要创建一个服务端类,只需要一次初始化.节约了时间空间,避免反复验证数据库与反复创建实例开销.
</p>
<p class="p indent" data-line="66"><span data-line="66"></span>服务端每与一个客户端相连,就将其<span data-line="66"></span><code class="code code1">tcpsocket</code><span data-line="66"></span>放入连接容器,分配一个socketid并与消息事件绑定.当不同的客户端发送请求,根据qt自带的信号槽队列,轮询执行操作(<span data-line="66"></span><em class="em-star1">中间操作</em><span data-line="66"></span>).<span data-line="66"></span><strong class="strong-star2">保证服务端无冲突正确处理批量操作</strong><span data-line="66"></span>,socketid作为<span data-line="66"></span><em class="em-star1">中间操作</em><span data-line="66"></span>的参数传入,中间操作根据<span data-line="66"></span><em class="em-star1">统一格式的请求信息</em><span data-line="66"></span>调用具体操作,增强了通用性,与易扩展性,<span data-line="66"></span><strong class="strong-star2">实现多客户端执行所有通用操作</strong><span data-line="66"></span>
</p>
<p class="p indent" data-line="68"><span data-line="68"></span>服务端类<span data-line="68"></span><code class="code code1">server</code><span data-line="68"></span>主要负责:
        <span data-line="69"></span><em class="em-star1"> 数据的存储: 所有数据存储在服务端,本地只存储部分数据
        </em><span data-line="70"></span> 权限鉴别: 使用session/cookie机制,<span data-line="70"></span><strong class="strong-star2">所有涉及权限的请求必须先核对权限,再执行操作,操作合法则修改服务端数据,反馈客户端执行结果</strong><span data-line="70"></span>.在一定程度上,防御了伪造请求越权操作.
        <span data-line="71"></span><em class="em-star1"> 数据逻辑: 判断请求合法性,增添删除修改数据等实体功能
        </em><span data-line="72"></span> 解析/编码请求: 利用json作为数据与客户端交互,对收到的二进制串进行json解析,对发送的数据编码为json. 
</p><h3 id="section" class="h2" data-line="74" data-heading-depth="2" style="display:block"><span data-line="74"></span><span class="heading-before"><span class="heading-label">3.2</span>.&#8194;</span><span data-line="74"></span>基本功能</h3><h4 id="section" class="h3" data-line="76" data-heading-depth="3" style="display:block"><span data-line="76"></span><span class="heading-before"><span class="heading-label">3.2.1</span>.&#8194;</span><span data-line="76"></span>用户权限</h4>
<p class="p noindent" data-line="77"><span data-line="77"></span>系统面向四类用户:游客,普通用户,版主,管理员,主要区别如下
        <span data-line="78"></span><em class="em-star1"> 游客：只有浏览权限，任何提交操作无效
        </em><span data-line="79"></span> 普通用户: 正常登录浏览注销,正常发帖,删除自己帖子,跟帖回复,修改个人信息等
        <span data-line="80"></span><em class="em-star1"> 版主:在普通用户基础上,有权限任意删除自家版块的帖子
        </em><span data-line="81"></span> 管理员:在普通用户基础上,有权删除任何帖子,有权限删除用户,更新用户权限,即任命版主,创建新版块等
</p><h4 id="section" class="h3" data-line="83" data-heading-depth="3" style="display:block"><span data-line="83"></span><span class="heading-before"><span class="heading-label">3.2.2</span>.&#8194;</span><span data-line="83"></span>注册</h4>
<p class="p noindent" data-line="84"><span data-line="84"></span>输入用户名,密码,重复密码,email即可注册.详细请见<span data-line="84"></span><a href="#regcheck" title="3.3.1.&#8194;注册检查" class="localref" style="target-element:h3"><span class="heading-label">3.3.1</span></a><span data-line="84"></span>
</p><h4 id="section" class="h3" data-line="87" data-heading-depth="3" style="display:block"><span data-line="87"></span><span class="heading-before"><span class="heading-label">3.2.3</span>.&#8194;</span><span data-line="87"></span>登录</h4>
<p class="p noindent" data-line="89"><span data-line="89"></span>非游客用户可以使用用户名密码登录.登录验证请求发送请求到服务端,返回验证结果:
        <span data-line="90"></span><em class="em-star1"> 若登录失败,返回错误类型,解析显示.如用户名不存在,密码错误等
        </em><span data-line="91"></span> 若登录成功,返回cookie,登录首页,下载用户信息.下载的用户信息中不存在用户的密码
</p><h4 id="section" class="h3" data-line="93" data-heading-depth="3" style="display:block"><span data-line="93"></span><span class="heading-before"><span class="heading-label">3.2.4</span>.&#8194;</span><span data-line="93"></span>游客登录</h4>
<p class="p noindent" data-line="94"><span data-line="94"></span>游客状态登录系统,菜单栏只有注销操作.在注册或登录窗口,点击退出会提示<span data-line="94"></span>&#8220;是否选择以游客身份登入&#8221;<span data-line="94"></span>,若选择yes则游客登录.
</p><h4 id="section" class="h3" data-line="96" data-heading-depth="3" style="display:block"><span data-line="96"></span><span class="heading-before"><span class="heading-label">3.2.5</span>.&#8194;</span><span data-line="96"></span>页</h4>
<p class="p noindent" data-line="97"><span data-line="97"></span>主页,帖子页和用户列表页的父类.分为<span data-line="97"></span><em class="em-star1">顶栏</em><span data-line="97"></span>和<span data-line="97"></span><em class="em-star1">正文区</em><span data-line="97"></span>两个部分,详见特色功能<span data-line="97"></span><a href="#fatherpage" title="3.3.3.&#8194;页" class="localref" style="target-element:h3"><span class="heading-label">3.3.3</span></a><span data-line="97"></span>
</p>
<blockquote data-line="99">

<p class="p noindent" data-line="99"><span data-line="99"></span>注: 以下各子类页(主页,帖子页,用户列表页),默认讨论正文区
</p></blockquote><h4 id="section" class="h3" data-line="101" data-heading-depth="3" style="display:block"><span data-line="101"></span><span class="heading-before"><span class="heading-label">3.2.6</span>.&#8194;</span><span data-line="101"></span>主页</h4>
<p class="p noindent" data-line="102"><span data-line="102"></span>论坛主页左侧显示版块,可以选中.右侧显示选中板块下的所有帖页.每次打开主页时,只下载版块列表与版块下的贴页列表.不下载具体每个帖子的内容
</p><h4 id="section" class="h3" data-line="104" data-heading-depth="3" style="display:block"><span data-line="104"></span><span class="heading-before"><span class="heading-label">3.2.7</span>.&#8194;</span><span data-line="104"></span>注销操作</h4>
<p class="p noindent" data-line="105"><span data-line="105"></span>任意用户退出当前登录状态,重新登录
</p><h4 id="section" class="h3" data-line="107" data-heading-depth="3" style="display:block"><span data-line="107"></span><span class="heading-before"><span class="heading-label">3.2.8</span>.&#8194;</span><span data-line="107"></span>查看个人信息</h4>
<p class="p noindent" data-line="108"><span data-line="108"></span>非游客可查看个人信息,如出生日期,性别,email等
</p><h4 id="section" class="h3" data-line="110" data-heading-depth="3" style="display:block"><span data-line="110"></span><span class="heading-before"><span class="heading-label">3.2.9</span>.&#8194;</span><span data-line="110"></span>修改个人信息</h4>
<p class="p noindent" data-line="111"><span data-line="111"></span>非游客可以修改出生日期,性别,密码等信息.信息有格式限制.若格式非法,则返回错误代码
</p><h4 id="section" class="h3" data-line="113" data-heading-depth="3" style="display:block"><span data-line="113"></span><span class="heading-before"><span class="heading-label">3.2.10</span>.&#8194;</span><span data-line="113"></span>论坛版块</h4>
<p class="p noindent" data-line="114"><span data-line="114"></span>论坛由多个版块组成,每个版块有唯一的版主,板块下有对应帖页的标题．
</p><h4 id="section" class="h3" data-line="116" data-heading-depth="3" style="display:block"><span data-line="116"></span><span class="heading-before"><span class="heading-label">3.2.11</span>.&#8194;</span><span data-line="116"></span>浏览帖子</h4>
<p class="p noindent" data-line="117"><span data-line="117"></span>点击主页右侧帖页，弹出新的一页显示整个帖子楼层，称该页为<span data-line="117"></span><strong class="strong-star2"><em class="em-star1">帖子页</em></strong><span data-line="117"></span>.这一过程中,下载点击贴页中所有的帖子.
</p><h4 id="section" class="h3" data-line="119" data-heading-depth="3" style="display:block"><span data-line="119"></span><span class="heading-before"><span class="heading-label">3.2.12</span>.&#8194;</span><span data-line="119"></span>发送帖子</h4>
<p class="p noindent" data-line="121"><span data-line="121"></span>点击主页右侧post键,点击输入新帖子的标题,以及一楼内容,点击确定提交.服务器鉴定权限与格式判断:
        <span data-line="122"></span><em class="em-star1"> 若无此用户或者内容为空,则会返回状态0,解析状态显示错误.
        </em><span data-line="123"></span> 若判断成功,返回状态0,提示成功post
</p><h4 id="section" class="h3" data-line="125" data-heading-depth="3" style="display:block"><span data-line="125"></span><span class="heading-before"><span class="heading-label">3.2.13</span>.&#8194;</span><span data-line="125"></span>删除帖子</h4>
<p class="p noindent" data-line="126"><span data-line="126"></span>点击主页右侧delete键,进入多选模式,选中删除.删除条件为以下:
1. 游客无权限删帖子
2. 普通用户可以删除自己发布的且还没有评论的帖子
3. 版主可以删除自家版块的帖子
4. 管理员可以删除所有帖子
</p><h4 id="section" class="h3" data-line="132" data-heading-depth="3" style="display:block"><span data-line="132"></span><span class="heading-before"><span class="heading-label">3.2.14</span>.&#8194;</span><span data-line="132"></span>浏览帖子</h4>
<p class="p noindent" data-line="134"><span data-line="134"></span>点击主页帖子,添加<span data-line="134"></span><strong class="strong-star2">帖子页</strong><span data-line="134"></span>并自动跳转.帖子分为三个部分:
1. 标题:显示在最顶端
2. 帖子以及跟帖: 显示在中间大部分
3. 评论框: 显示在最底端
</p><h4 id="section" class="h3" data-line="139" data-heading-depth="3" style="display:block"><span data-line="139"></span><span class="heading-before"><span class="heading-label">3.2.15</span>.&#8194;</span><span data-line="139"></span>帖子</h4>
<p class="p noindent" data-line="141"><span data-line="141"></span>帖子由以下几部分组成:
</p>
<ol class="ol compact" data-line="143">
<li class="li ol-li compact-li" data-line="143"><span data-line="143"></span>发帖者用户名
</li>
<li class="li ol-li compact-li" data-line="144"><span data-line="144"></span>帖子正文: 靠上对齐
</li>
<li class="li ol-li compact-li" data-line="145"><span data-line="145"></span>帖子状态栏:显示发帖时间
</li>
<li class="li ol-li compact-li" data-line="146"><span data-line="146"></span>赞同(upvotes)与反对(downvotes)按钮:显示赞同数与反对数
</li>
<li class="li ol-li compact-li" data-line="147"><span data-line="147"></span>评论(comment)按钮: 点击后,<span data-line="147"></span><strong class="strong-star2">评论框正文后添加<code class="code code1">@&lt;发帖者用户名&gt;</code></strong><span data-line="147"></span>
</li></ol>
<h4 id="section" class="h3" data-line="149" data-heading-depth="3" style="display:block"><span data-line="149"></span><span class="heading-before"><span class="heading-label">3.2.16</span>.&#8194;</span><span data-line="149"></span>评论</h4>
<p class="p noindent" data-line="151"><span data-line="151"></span>评论由以下部分组成:
</p>
<ol class="ol compact" data-line="153">
<li class="li ol-li compact-li" data-line="153"><span data-line="153"></span>文本框:点击文本框编辑评论,字数限制1<span data-line="153"></span>~<span data-line="153"></span>2000
</li>
<li class="li ol-li compact-li" data-line="154"><span data-line="154"></span>清除按钮(clear):点击清空评论
</li>
<li class="li ol-li compact-li" data-line="155"><span data-line="155"></span>发帖按钮(post):发送帖子,若反馈符合规定(字数限制等),显示成功并刷新页面,否则在提示区提示错误
</li>
<li class="li ol-li compact-li" data-line="156"><span data-line="156"></span>提示区:默认隐藏,若出现问题,则显示错误所在
</li></ol>
<h4 id="section" class="h3" data-line="158" data-heading-depth="3" style="display:block"><span data-line="158"></span><span class="heading-before"><span class="heading-label">3.2.17</span>.&#8194;</span><span data-line="158"></span>查看用户列表</h4>
<p class="p noindent" data-line="159"><span data-line="159"></span>root(管理员)有权限查看用户列表.点击<span data-line="159"></span><code class="code code1">user list</code><span data-line="159"></span>,打开用户列表页.列表显示:
</p>
<pre class="para-block pre-indented" data-line="161" style="display:block"><code>    * 用户名
    * 用户权限 :Normal,Board manager,Root
    * 备注: 若为某版版主,则显示版块名</code></pre>
<p class="p noindent para-continued" data-line="165"><span data-line="165"></span>管理员可以选中任一用户,选则执行以下功能:
      <span data-line="166"></span><br>
<span data-line="167"></span>        <span data-line="167"></span><em class="em-star1"> 删除用户: 不能删除自己(root唯一)
        </em><span data-line="168"></span> 升级权限(任命版主): 详见特色功能<span data-line="168"></span><a href="#levelup" title="3.3.6.&#8194;升级权限" class="localref" style="target-element:h3"><span class="heading-label">3.3.6</span></a><span data-line="168"></span>
</p><h3 id="section" class="h2" data-line="172" data-heading-depth="2" style="display:block"><span data-line="172"></span><span class="heading-before"><span class="heading-label">3.3</span>.&#8194;</span><span data-line="172"></span>特色功能</h3><h4 id="regcheck" class="h3" data-line="174" data-heading-depth="3" style="display:block"><span data-line="174"></span><span class="heading-before"><span class="heading-label">3.3.1</span>.&#8194;</span><span data-line="174"></span>注册检查</h4>
<p class="p noindent" data-line="176"><span data-line="176"></span>注册时有以下限制条件:
1. 用户名由大小写字母,阿拉伯数字及下划线构成,长度为6-20位,且未注册过
2. 密码最短8位,至少有一个大写字母,一个小写字母和一个数字
3. 正确重复密码
4. email需满足类似<span data-line="180"></span><code class="code code1">xxx@abc.com</code><span data-line="180"></span>的格式
</p>
<p class="p indent" data-line="182"><span data-line="182"></span>提交表单时,若以上出现问题,则会在输入框附近,对用户进行提示
</p><h4 id="guestin" class="h3" data-line="185" data-heading-depth="3" style="display:block"><span data-line="185"></span><span class="heading-before"><span class="heading-label">3.3.2</span>.&#8194;</span><span data-line="185"></span>游客登录方式</h4>
<p class="p noindent" data-line="186"><span data-line="186"></span>登录或注册窗口点击右上角退出,显示下图:
</p>
<p class="p indent" data-line="188"><span data-line="188"></span>选择No则直接退出程序,选择Yes则以游客方式登录,Cancel为取消
</p><h4 id="fatherpage" class="h3" data-line="190" data-heading-depth="3" style="display:block"><span data-line="190"></span><span class="heading-before"><span class="heading-label">3.3.3</span>.&#8194;</span><span data-line="190"></span>页</h4>
<p class="p noindent" data-line="192"><span data-line="192"></span>前端类为一个父类,整体由两个部分组成:
</p>
<ol class="ol compact" data-line="194">
<li class="li ol-li compact-li" data-line="194"><span data-line="194"></span>顶栏
</li>
<li class="li ol-li compact-li" data-line="195"><span data-line="195"></span>正文区
</li></ol>

<p class="p noindent" data-line="197"><span data-line="197"></span>顶栏由三个部分组成:
</p>
<ol class="ol compact" data-line="199">
<li class="li ol-li compact-li" data-line="199"><span data-line="199"></span>Bebop: logo,点击新建并跳转到主页
</li>
<li class="li ol-li compact-li" data-line="200"><span data-line="200"></span>刷新按钮: 点击刷新整页.刷新函数refreshpage()为一个虚函数,各子类实现多态
</li>
<li class="li ol-li compact-li" data-line="201"><span data-line="201"></span>用户按钮: 默认显示 <span data-line="201"></span>&#8220;Hi,<用户名>&#8221;<span data-line="201"></span>.点击展开用户功能列表:

<pre class="para-block pre-indented" data-line="202" style="display:block"><code> * 游客:只有注销
 * 普通用户与版主: 可以查看个人资料,修改个人资料,注销
 * 管理员:在普通用户基础上,添加&quot;进入用户列表页&quot;功能</code></pre></li></ol>
<h4 id="section" class="h3" data-line="206" data-heading-depth="3" style="display:block"><span data-line="206"></span><span class="heading-before"><span class="heading-label">3.3.4</span>.&#8194;</span><span data-line="206"></span>仿浏览器前端</h4>
<p class="p noindent" data-line="207"><span data-line="207"></span>模仿浏览器,包括界面风格,交互方式,乃至请求方式,内存管理.符合当今人的使用操作习惯
      <span data-line="208"></span><br>
<span data-line="209"></span>        <span data-line="209"></span><em class="em-star1"> 界面风格:
                - 登录注册界面仿照</em><span data-line="210"></span>Github<span data-line="210"></span><em class="em-star1">,</em><span data-line="210"></span><em class="em-star1">附加友好的提示信息</em><span data-line="210"></span><em class="em-star1">引导用户注册登录.
                - 主界面UI</em><span data-line="211"></span><em class="em-star1">简洁而不简单</em><span data-line="211"></span><em class="em-star1">,便于信息的传播.
        </em><span data-line="212"></span> 交互方式:
<span data-line="213"></span> <span data-line="213"></span> <span data-line="213"></span> <span data-line="213"></span> <span data-line="213"></span> <span data-line="213"></span> <span data-line="213"></span> <span data-line="213"></span> <span data-line="213"></span> <span data-line="213"></span> <span data-line="213"></span> <span data-line="213"></span> <span data-line="213"></span> <span data-line="213"></span> <span data-line="213"></span> <span data-line="213"></span> <span data-line="213"></span>- 采用的<span data-line="213"></span><strong class="strong-star2">tab页式前端</strong><span data-line="213"></span>方便人们在不同种类的页面间切换
<span data-line="214"></span> <span data-line="214"></span> <span data-line="214"></span> <span data-line="214"></span> <span data-line="214"></span> <span data-line="214"></span> <span data-line="214"></span> <span data-line="214"></span> <span data-line="214"></span> <span data-line="214"></span> <span data-line="214"></span> <span data-line="214"></span> <span data-line="214"></span> <span data-line="214"></span> <span data-line="214"></span> <span data-line="214"></span> <span data-line="214"></span>- 采用顶栏设计,左侧logo首页链接,右侧用户下拉菜单按钮,配合页面刷新按键.功能强大,清晰而友好
        <span data-line="215"></span><em class="em-star1"> 请求方式:
                - 前端只负责数据的采集,显示返回,逻辑层全部交给<code class="code code1">client</code>来与<code class="code code1">server</code>交互,充分解耦
        </em><span data-line="217"></span> 内存管理:
<span data-line="218"></span> <span data-line="218"></span> <span data-line="218"></span> <span data-line="218"></span> <span data-line="218"></span> <span data-line="218"></span> <span data-line="218"></span> <span data-line="218"></span> <span data-line="218"></span> <span data-line="218"></span> <span data-line="218"></span> <span data-line="218"></span> <span data-line="218"></span> <span data-line="218"></span> <span data-line="218"></span> <span data-line="218"></span> <span data-line="218"></span>- 每次请求只请求当前页面所需信息,节约内存,提高效率.
<span data-line="219"></span> <span data-line="219"></span> <span data-line="219"></span> <span data-line="219"></span> <span data-line="219"></span> <span data-line="219"></span> <span data-line="219"></span> <span data-line="219"></span> <span data-line="219"></span> <span data-line="219"></span> <span data-line="219"></span> <span data-line="219"></span> <span data-line="219"></span> <span data-line="219"></span> <span data-line="219"></span> <span data-line="219"></span> <span data-line="219"></span>- 便于与服务器端同步与更新
</p><h4 id="section" class="h3" data-line="221" data-heading-depth="3" style="display:block"><span data-line="221"></span><span class="heading-before"><span class="heading-label">3.3.5</span>.&#8194;</span><span data-line="221"></span>创建版块</h4>
<p class="p noindent" data-line="222"><span data-line="222"></span>更新版主时可以选择<span data-line="222"></span><code class="code code1">&lt;New Board&gt;</code><span data-line="222"></span>创建新的版块并成为新版块版主,详见<span data-line="222"></span><a href="#levelup" title="3.3.6.&#8194;升级权限" class="localref" style="target-element:h3"><span class="heading-label">3.3.6</span></a><span data-line="222"></span>
</p><h4 id="levelup" class="h3" data-line="224" data-heading-depth="3" style="display:block"><span data-line="224"></span><span class="heading-before"><span class="heading-label">3.3.6</span>.&#8194;</span><span data-line="224"></span>升级权限</h4>
<p class="p noindent" data-line="226"><span data-line="226"></span>可以提升普通用户或版主的权限:
        <span data-line="227"></span><em class="em-star1"> 一个版块最多只有一个版主(可以没有版主),一个用户只能为一个版块的版主
        </em><span data-line="228"></span> 普通用户可以成为某版块版主.若有原版主,原版主变为普通用户
        <span data-line="229"></span><em class="em-star1"> 版主可以切换为另一版块版主,原版块失去版主,另一版块原版主成为普通用户
        </em><span data-line="230"></span> 可以新建新版块而不选择已有版块.则发送创建版块请求:
<span data-line="231"></span> <span data-line="231"></span> <span data-line="231"></span> <span data-line="231"></span> <span data-line="231"></span> <span data-line="231"></span> <span data-line="231"></span> <span data-line="231"></span> <span data-line="231"></span> <span data-line="231"></span> <span data-line="231"></span> <span data-line="231"></span> <span data-line="231"></span> <span data-line="231"></span> <span data-line="231"></span> <span data-line="231"></span> <span data-line="231"></span>- 若新建版块名称为已有版块,则已有版块版主为选择用户,若存在原版主替换规则同上
<span data-line="232"></span> <span data-line="232"></span> <span data-line="232"></span> <span data-line="232"></span> <span data-line="232"></span> <span data-line="232"></span> <span data-line="232"></span> <span data-line="232"></span> <span data-line="232"></span> <span data-line="232"></span> <span data-line="232"></span> <span data-line="232"></span> <span data-line="232"></span> <span data-line="232"></span> <span data-line="232"></span> <span data-line="232"></span> <span data-line="232"></span>- 判断新版块名称是否满足要求:包括长度1-32,有效字符等(可选).不成功则返回错误代码
</p><h4 id="section" class="h3" data-line="234" data-heading-depth="3" style="display:block"><span data-line="234"></span><span class="heading-before"><span class="heading-label">3.3.7</span>.&#8194;</span><span data-line="234"></span>刷新界面</h4>
<ol class="ol compact" data-line="236">
<li class="li ol-li compact-li" data-line="236"><span data-line="236"></span>刷新函数为tab(页)类的虚函数,由不同子类页进行泛化.
</li>
<li class="li ol-li compact-li" data-line="237"><span data-line="237"></span>位于顶栏,点击即可刷新本页面,用户主动与服务端同步.(非主动如发帖后,第一次打开页面时自动与服务端同步).
</li>
<li class="li ol-li compact-li" data-line="238"><span data-line="238"></span>每次刷新只获取当前页面的数据,节约开销.
</li></ol>
<h4 id="section" class="h3" data-line="240" data-heading-depth="3" style="display:block"><span data-line="240"></span><span class="heading-before"><span class="heading-label">3.3.8</span>.&#8194;</span><span data-line="240"></span>多用户</h4>
<ol class="ol compact" data-line="241">
<li class="li ol-li compact-li" data-line="241"><span data-line="241"></span>采用<span data-line="241"></span><strong class="strong-star2">C/S架构</strong><span data-line="241"></span>,实现多用户模式.
</li>
<li class="li ol-li compact-li" data-line="242"><span data-line="242"></span>采用<span data-line="242"></span><strong class="strong-star2">session/cookie机制</strong><span data-line="242"></span>,保证访问的安全性,提高了可用性
</li>
<li class="li ol-li compact-li" data-line="243"><span data-line="243"></span>利用qt<span data-line="243"></span><strong class="strong-star2">信号map映射</strong><span data-line="243"></span>与<span data-line="243"></span><strong class="strong-star2">信号槽内部队列</strong><span data-line="243"></span>,实现了请求队列,避免了访存冲突.
</li>
<li class="li ol-li compact-li" data-line="244"><span data-line="244"></span>对于目前规模的网站(平均在线不到1000人),并发的可能性极低,并且即使并发,以目前的数据规模,单线程队列完全可以胜任.结合目前的需求与数据库设计,为了降低工程维护的复杂性,不采用多线程机制.
</li></ol>
<h2 id="section" class="h1" data-line="247" data-heading-depth="1" style="display:block"><span data-line="247"></span><span class="heading-before"><span class="heading-label">4</span>.&#8194;</span><span data-line="247"></span>设计模式优点及其体现</h2><h3 id="oop" class="h2" data-line="249" data-heading-depth="2" style="display:block"><span data-line="249"></span><span class="heading-before"><span class="heading-label">4.1</span>.&#8194;</span><span data-line="249"></span>面向对象特征体现</h3><h4 id="section" class="h3" data-line="251" data-heading-depth="3" style="display:block"><span data-line="251"></span><span class="heading-before"><span class="heading-label">4.1.1</span>.&#8194;</span><span data-line="251"></span>封装性</h4>
<p class="p noindent" data-line="252"><span data-line="252"></span>封装性很重要，它可以避免外部对象修改对象内部的状态，从而引起对象本身的稳定性，因此在代码编写过程中，要尽量考虑到对象的每个属性，不需要暴露的，尽量不要暴露。
</p><h4 id="section" class="h3" data-line="254" data-heading-depth="3" style="display:block"><span data-line="254"></span><span class="heading-before"><span class="heading-label">4.1.2</span>.&#8194;</span><span data-line="254"></span>继承</h4>
<p class="p noindent" data-line="255"><span data-line="255"></span>继承性，使不同的类，有相同的方法，这样可以最大程度地重用代码。
</p><h4 id="section" class="h3" data-line="258" data-heading-depth="3" style="display:block"><span data-line="258"></span><span class="heading-before"><span class="heading-label">4.1.3</span>.&#8194;</span><span data-line="258"></span>多态</h4>
<p class="p noindent" data-line="259"><span data-line="259"></span>多态使得我们可以使用相同的方法处理不同对象的行为：我们可以使用相同的代码处理不同的类型的对象，只要它们继承和实现了相同的类型。
</p><h3 id="sec-cs" class="h2" data-line="262" data-heading-depth="2" style="display:block"><span data-line="262"></span><span class="heading-before"><span class="heading-label">4.2</span>.&#8194;</span><span data-line="262"></span>C/S架构</h3><h4 id="section" class="h3" data-line="264" data-heading-depth="3" style="display:block"><span data-line="264"></span><span class="heading-before"><span class="heading-label">4.2.1</span>.&#8194;</span><span data-line="264"></span>通信实现</h4>
<ul class="ul list-star compact" data-line="266">
<li class="li ul-li list-star-li compact-li" data-line="266"><span data-line="266"></span>借助<span data-line="266"></span><code class="code code1">QTcpserver</code><span data-line="266"></span>实现服务端端口监听
</li>
<li class="li ul-li list-star-li compact-li" data-line="267"><span data-line="267"></span>借助<span data-line="267"></span><code class="code code1">QTcpsocket</code><span data-line="267"></span>实现端与端间通信
</li>
<li class="li ul-li list-star-li compact-li" data-line="268"><span data-line="268"></span>通信信息:<span data-line="268"></span><code class="code code1">Json object</code><span data-line="268"></span>转成的<span data-line="268"></span><code class="code code1">bit</code><span data-line="268"></span>串
</li></ul>
<h4 id="answer" class="h3" data-line="270" data-heading-depth="3" style="display:block"><span data-line="270"></span><span class="heading-before"><span class="heading-label">4.2.2</span>.&#8194;</span><span data-line="270"></span>通信格式</h4>
<p class="p noindent" data-line="272"><span data-line="272"></span>客户端请求格式
</p>
<pre class="para-block pre-fenced pre-fenced3" data-line="273" data-line-first="274" style="display:block"><code data-line="274">{
        &#39;func&#39;: &#39;&lt;函数名称&gt;&#39;
        &#39;params&#39;:{
                &lt;参数表&gt;
        }
}</code></pre>
<p class="p noindent para-continued" data-line="282"><span data-line="282"></span>服务端应答格式 
</p>
<pre class="para-block pre-fenced pre-fenced3" data-line="283" data-line-first="284" style="display:block"><code data-line="284">{
        &#39;status&#39;: &#39;整型状态号&#39;
        &#39;content&#39;:{
                &lt;内容&gt;
        }
}</code></pre><h4 id="section" class="h3" data-line="292" data-heading-depth="3" style="display:block"><span data-line="292"></span><span class="heading-before"><span class="heading-label">4.2.3</span>.&#8194;</span><span data-line="292"></span>多用户实现</h4>
<ol class="ol compact" data-line="294">
<li class="li ol-li compact-li" data-line="294"><span data-line="294"></span>服务端监听某端口,客户端向该端口发送请求
</li>
<li class="li ol-li compact-li" data-line="295"><span data-line="295"></span>服务端存在一个<span data-line="295"></span><code class="code code1">QTcpsocket</code><span data-line="295"></span>容器,每<span data-line="295"></span><code class="code code1">listen</code><span data-line="295"></span>到一个<span data-line="295"></span><code class="code code1">QTcpsocket</code><span data-line="295"></span>的新连接,将其放入容器中.
</li>
<li class="li ol-li compact-li" data-line="296"><span data-line="296"></span>每将一个<span data-line="296"></span><code class="code code1">QTcpsocket</code><span data-line="296"></span>放入容器中时,对其指定一个<span data-line="296"></span><code class="code code1">socketId</code><span data-line="296"></span>,并通过QT信号槽map机制,将<span data-line="296"></span><code class="code code1">QTcpsocket</code><span data-line="296"></span>的<span data-line="296"></span><em class="em-star1">请求信号</em><span data-line="296"></span>与<span data-line="296"></span><em class="em-star1">断开链接信号</em><span data-line="296"></span>各自对应于以<span data-line="296"></span><code class="code code1">socketId</code><span data-line="296"></span>为参数的<span data-line="296"></span><em class="em-star1">请求信号处理槽</em><span data-line="296"></span>与<span data-line="296"></span><em class="em-star1">断开链接处理槽</em><span data-line="296"></span>,保证一一对应关系
</li>
<li class="li ol-li compact-li" data-line="297"><span data-line="297"></span>访问的互斥性通过<span data-line="297"></span><em class="em-star1">QT信号队列机制</em><span data-line="297"></span>实现.即使高并发,高访问量,也不会出现访问的冲突.保证了多用户模式的可用性
</li>
<li class="li ol-li compact-li" data-line="298"><span data-line="298"></span>对于用户个体,采用session/cookie机制,实现了权限校验,提高了访问的安全性,处理了用户登录的唯一性(用户登录状态未退出,二次登录,前一次cookiee过期)
</li></ol>
<h3 id="section" class="h2" data-line="300" data-heading-depth="2" style="display:block"><span data-line="300"></span><span class="heading-before"><span class="heading-label">4.3</span>.&#8194;</span><span data-line="300"></span>单例模式</h3>
<p class="p noindent" data-line="301"><span data-line="301"></span>确保系统中某个对象的唯一性,提高了系统的灵活性,节约内存开销.
</p><h4 id="sec--" class="h3" data-line="303" data-heading-depth="3" style="display:block"><span data-line="303"></span><span class="heading-before"><span class="heading-label">4.3.1</span>.&#8194;</span><span data-line="303"></span>单例模式的实现模型:</h4>
<pre class="para-block pre-fenced pre-fenced3 language-cpp lang-cpp cpp colorized" data-line="305" data-line-first="306" style="display:block"><code data-line="306"><span style="color:blue">class</span> singleton{

<span style="color:blue">private</span>:
        singleton(); <span style="color:darkgreen">//构造函数</span>
        singleton(singleton <span style="color:blue">const</span>&amp;);<span style="color:darkgreen">//拷贝函数不实现,也不许继承实现</span>
        <span style="color:teal">void</span> <span style="color:blue">operator</span>=(singleton <span style="color:blue">const</span>&amp;);<span style="color:darkgreen">//等号重载不实现,也不许继承</span>
<span style="color:blue">public</span> :
        <span style="color:darkgreen">//类函数ins(),返回静态对象instance</span>
        <span style="color:darkgreen">//每次只能通过singleton::ins()来调用singleton唯一的实例.</span>
        <span style="color:blue">static</span> singleton&amp; ins(){
                <span style="color:blue">static</span> singleton instance;
                <span style="color:blue">return</span> instance;
        }
};</code></pre>
<p class="p noindent para-continued" data-line="323"><span data-line="323"></span>采用单例模式的类如下:
</p>
<p class="p indent" data-line="325"><span data-line="325"></span>client 客户端控制类
</p>
<pre class="para-block pre-indented" data-line="326" style="display:block"><code>    ~ 无论有多少个前端对象,涉及到请求与应答,都来调用唯一的client</code></pre>
<p class="p noindent para-continued" data-line="327"><span data-line="327"></span>server 服务端控制类
</p>
<pre class="para-block pre-indented" data-line="328" style="display:block"><code>    ~ 无论多少个用户在线,都是由server来执行操作.用户只是将请求提交给server,server来执行实际的操作.</code></pre><h3 id="sec-sessioncookie" class="h2" data-line="330" data-heading-depth="2" style="display:block"><span data-line="330"></span><span class="heading-before"><span class="heading-label">4.4</span>.&#8194;</span><span data-line="330"></span>session/cookie机制</h3><h4 id="sec--" class="h3" data-line="332" data-heading-depth="3" style="display:block"><span data-line="332"></span><span class="heading-before"><span class="heading-label">4.4.1</span>.&#8194;</span><span data-line="332"></span>使用理由:</h4>
<p class="p noindent" data-line="334"><span data-line="334"></span>业务逻辑层与数据我们都存放在服务端,称之为后端,用户通过利用Tcpsocket从前端向后端发送<span data-line="334"></span><strong class="strong-star2">请求</strong><span data-line="334"></span>来支配数据.
</p>
<p class="p indent" data-line="336"><span data-line="336"></span>但是<span data-line="336"></span><strong class="strong-star2">请求</strong><span data-line="336"></span>不一定是合法的.比如普通用户发送超过本身权限的请求(如删除他人帖子),更为严重的是根据网络模型,Tcpserver请求是可以<span data-line="336"></span><strong class="strong-star2">伪造</strong><span data-line="336"></span>并发送的..
</p>
<p class="p indent" data-line="338"><span data-line="338"></span>采用及时生成的cookie,极大地降低了请求的可伪造性,提高了安全性
</p><h4 id="section" class="h3" data-line="340" data-heading-depth="3" style="display:block"><span data-line="340"></span><span class="heading-before"><span class="heading-label">4.4.2</span>.&#8194;</span><span data-line="340"></span>实现机制与优点</h4>
<ol class="ol compact" data-line="342">
<li class="li ol-li compact-li" data-line="342"><span data-line="342"></span>每次一个用户成功login,则根据<span data-line="342"></span><code class="code code1">&lt;用户id&gt;&lt;密码&gt;&lt;当前时间&gt;</code><span data-line="342"></span>md5-hash为一个32位的字符串str.
</li>
<li class="li ol-li compact-li" data-line="343"><span data-line="343"></span>将<span data-line="343"></span><code class="code code1">(str,&lt;用户id&gt;)</code><span data-line="343"></span>存入session表中(Map),并将str作为返回content项中(详见<span data-line="343"></span><a href="#answer" title="4.2.2.&#8194;通信格式" class="localref" style="target-element:h3"><span class="heading-label">4.2.2</span></a><span data-line="343"></span>)的cookie项,返回给客户端<span data-line="343"></span><code class="code code1">client</code><span data-line="343"></span>
</li>
<li class="li ol-li compact-li" data-line="344"><span data-line="344"></span><code class="code code1">clien</code><span data-line="344"></span>类成员cookie保存返回cookie.每次调用到需要鉴别权限的方法时,都要将cookie放入params发送json.
</li>
<li class="li ol-li compact-li" data-line="345"><span data-line="345"></span>服务端收到cookie后,去session表中查询用户id.若存在则得到,若不存在则反馈status=0,客户端表现为<span data-line="345"></span>&#8220;Permission Denied&#8221;<span data-line="345"></span>
5.若用户存在,则鉴别权限.如果权限不够,返回status=0,客户端<span data-line="346"></span>&#8220;Permission Denied&#8221;<span data-line="346"></span> .用户的权限与信息,不能作为请求的参数,只能由后端来确认.
</li>
<li class="li ol-li compact-li" data-line="347"><span data-line="347"></span>每次存入session时,先要查找是否用户名已经存在(该用户已经登录),若已经存在,则原session过期,生成新的session存入.这样保证了用户登录的唯一性.
</li></ol>
<h3 id="database" class="h2" data-line="349" data-heading-depth="2" style="display:block"><span data-line="349"></span><span class="heading-before"><span class="heading-label">4.5</span>.&#8194;</span><span data-line="349"></span>磁盘数据库/内存数据库模型</h3>
<p class="p noindent" data-line="350"><span data-line="350"></span>现代网站架构中,缓存数据库如Redis与磁盘数据库如mysql等往往同时存在,本论坛设计中,也采用如此架构.其优势在于<span data-line="350"></span><strong class="strong-star2">尽量减少IO次数,提高处理请求的速度</strong><span data-line="350"></span>
</p>
<p class="p indent" data-line="352"><span data-line="352"></span>采用了<span data-line="352"></span><em class="em-star1">容器</em><span data-line="352"></span>与<span data-line="352"></span><em class="em-star1">SQLite</em><span data-line="352"></span>分别作为内存数据库与磁盘数据库.
</p>
<blockquote data-line="353">

<p class="p noindent" data-line="353"><span data-line="353"></span> 虽然SQLite有内存与磁盘两种模式,对于QT,其对SQLite的操作依然是基于文件系统的.
</p></blockquote>
<p class="p noindent" data-line="355"><span data-line="355"></span>调用数据库流程如下:
</p>
<ol class="ol compact" data-line="357">
<li class="li ol-li compact-li" data-line="357"><span data-line="357"></span>服务器开启时,将<span data-line="357"></span><code class="code code1">SQlite</code><span data-line="357"></span>中数据读入<span data-line="357"></span><em class="em-star1">容器</em><span data-line="357"></span>中
</li>
<li class="li ol-li compact-li" data-line="358"><span data-line="358"></span>用户日常请求,只修改<span data-line="358"></span><em class="em-star1">容器</em><span data-line="358"></span>数据
</li>
<li class="li ol-li compact-li" data-line="359"><span data-line="359"></span>服务器定期将<span data-line="359"></span><em class="em-star1">容器</em><span data-line="359"></span>数据同步到<span data-line="359"></span><code class="code code1">SQlite</code><span data-line="359"></span>上
</li></ol>

<p class="p noindent" data-line="361"><span data-line="361"></span>数据库存储如下四表(对应四种基本数据结构):
1. 用户信息表<span data-line="362"></span><code class="code code1">users</code><span data-line="362"></span>:<span data-line="362"></span><code class="code code1">id,password,right,email,level,age,gender</code><span data-line="362"></span>
2. 帖子表<span data-line="363"></span><code class="code code1">posts</code><span data-line="363"></span>:<span data-line="363"></span><code class="code code1">post_id , page_id ,usr_id,content,ttime,upvotes, downvotes</code><span data-line="363"></span>,读取时按<span data-line="363"></span><code class="code code1">ttime</code><span data-line="363"></span>排序
3. 贴页表<span data-line="364"></span><code class="code code1">pagelets</code><span data-line="364"></span>:<span data-line="364"></span><code class="code code1">pagelet_id , board_id,starter_id ,title ,ttime</code><span data-line="364"></span>,同读取时按<span data-line="364"></span><code class="code code1">ttime</code><span data-line="364"></span>排序
4. 版块表<span data-line="365"></span><code class="code code1">boards</code><span data-line="365"></span>:<span data-line="365"></span><code class="code code1">name , manager_id</code><span data-line="365"></span>
</p><h2 id="section" class="h1" data-line="367" data-heading-depth="1" style="display:block"><span data-line="367"></span><span class="heading-before"><span class="heading-label">5</span>.&#8194;</span><span data-line="367"></span>具体实现</h2>
<p class="p noindent" data-line="368"><span data-line="368"></span>以下为代码具体实现的部分
</p><h3 id="datastruct" class="h2" data-line="370" data-heading-depth="2" style="display:block"><span data-line="370"></span><span class="heading-before"><span class="heading-label">5.1</span>.&#8194;</span><span data-line="370"></span>数据结构</h3>
<p class="p noindent" data-line="372"><span data-line="372"></span>以下类均为实体类,成员方法均为public:
</p>
<ol class="ol compact" data-line="374">
<li class="li ol-li compact-li" data-line="374"><span data-line="374"></span>userinfo 用户信息类
</li>
<li class="li ol-li compact-li" data-line="375"><span data-line="375"></span>post 帖子类
</li>
<li class="li ol-li compact-li" data-line="376"><span data-line="376"></span>pagelet 贴页类
</li>
<li class="li ol-li compact-li" data-line="377"><span data-line="377"></span>board 版块类
</li></ol>

<p class="p noindent" data-line="379"><span data-line="379"></span><strong class="strong-star2">无论是客户端还是服务端，都用以上四个类</strong><span data-line="379"></span>
</p><h4 id="section" class="h3" data-line="381" data-heading-depth="3" style="display:block"><span data-line="381"></span><span class="heading-before"><span class="heading-label">5.1.1</span>.&#8194;</span><span data-line="381"></span>相关文件</h4>
<pre class="para-block pre-fenced pre-fenced3" data-line="382" data-line-first="383" style="display:block"><code data-line="383">pagelet.h
board.h
post.h
userinfo.h
pagelet.cpp
board.cpp
post.cpp
userinfo.cpp</code></pre><h4 id="sec-userinfo-" class="h3" data-line="394" data-heading-depth="3" style="display:block"><span data-line="394"></span><span class="heading-before"><span class="heading-label">5.1.2</span>.&#8194;</span><span data-line="394"></span>userinfo 用户信息类</h4>
<p class="p noindent" data-line="397"><span data-line="397"></span>userinfo();
</p>
<pre class="para-block pre-indented" data-line="398" style="display:block"><code>    ~ 构造函数</code></pre>
<p class="p noindent para-continued" data-line="399"><span data-line="399"></span>userinfo(QString id,QString password,QString email);
</p>
<pre class="para-block pre-indented" data-line="400" style="display:block"><code>    ~ 构造函数重载,登录时使用</code></pre>
<p class="p noindent para-continued" data-line="401"><span data-line="401"></span>userinfo(QString id,QString password,int right,QString email,int level,QDate age,int gender);
</p>
<pre class="para-block pre-indented" data-line="402" style="display:block"><code>    ~ 构造函数重载,载入数据库时使用</code></pre>
<p class="p noindent para-continued" data-line="403"><span data-line="403"></span>userinfo(QJsonObject json);
</p>
<pre class="para-block pre-indented" data-line="404" style="display:block"><code>    ~ 构造函数重载,jsonobject-&gt;userinfo</code></pre>
<p class="p noindent para-continued" data-line="405"><span data-line="405"></span>QJsonObject tojson();
</p>
<pre class="para-block pre-indented" data-line="406" style="display:block"><code>    ~ userinfo转jsonobject
</code></pre>
<p class="p noindent para-continued" data-line="408"><span data-line="408"></span>QString id;
</p>
<pre class="para-block pre-indented" data-line="409" style="display:block"><code>    ~ 用户名,唯一</code></pre>
<p class="p noindent para-continued" data-line="410"><span data-line="410"></span>QString password
</p>
<pre class="para-block pre-indented" data-line="411" style="display:block"><code>    ~ 用户密码,存md5加密后的32位数字</code></pre>
<p class="p noindent para-continued" data-line="412"><span data-line="412"></span>int right; 
</p>
<pre class="para-block pre-indented" data-line="413" style="display:block"><code>    ~ 用户权限 游客(default): 0 ,普通用户:1,版主:2,管理员:3 </code></pre>
<p class="p noindent para-continued" data-line="414"><span data-line="414"></span>QString email;
</p>
<pre class="para-block pre-indented" data-line="415" style="display:block"><code>    ~ 用户邮箱地址</code></pre>
<p class="p noindent para-continued" data-line="416"><span data-line="416"></span>QDate age;
</p>
<pre class="para-block pre-indented" data-line="417" style="display:block"><code>    ~ 用户生日</code></pre>
<p class="p noindent para-continued" data-line="418"><span data-line="418"></span>int gender;
</p>
<pre class="para-block pre-indented" data-line="419" style="display:block"><code>    ~ 用户性别</code></pre>
<p class="p noindent para-continued" data-line="420"><span data-line="420"></span>int level;
</p>
<pre class="para-block pre-indented" data-line="421" style="display:block"><code>    ~ 用户等级</code></pre><h4 id="sec-post-" class="h3" data-line="424" data-heading-depth="3" style="display:block"><span data-line="424"></span><span class="heading-before"><span class="heading-label">5.1.3</span>.&#8194;</span><span data-line="424"></span>post 帖子类</h4>
<p class="p noindent" data-line="425"><span data-line="425"></span>post();
</p>
<pre class="para-block pre-indented" data-line="426" style="display:block"><code>    ~ 构造函数</code></pre>
<p class="p noindent para-continued" data-line="427"><span data-line="427"></span>post(QString post<span data-line="427"></span>_<span data-line="427"></span>id,QString page<span data-line="427"></span>_<span data-line="427"></span>id,QString usr<span data-line="427"></span>_<span data-line="427"></span>id,QString content,QTime time,long long upvotes,long long downvotes;
</p>
<pre class="para-block pre-indented" data-line="428" style="display:block"><code>    ~ 构造函数重载</code></pre>
<p class="p noindent para-continued" data-line="429"><span data-line="429"></span>post(QString post<span data-line="429"></span>_<span data-line="429"></span>id,QString page<span data-line="429"></span>_<span data-line="429"></span>id,QString usr<span data-line="429"></span>_<span data-line="429"></span>id,QString content);
</p>
<pre class="para-block pre-indented" data-line="430" style="display:block"><code>    ~ 构造函数重载</code></pre>
<p class="p noindent para-continued" data-line="431"><span data-line="431"></span>post(QJsonObject);
</p>
<pre class="para-block pre-indented" data-line="432" style="display:block"><code>    ~ 构造函数重载,json-&gt;post</code></pre>
<p class="p noindent para-continued" data-line="433"><span data-line="433"></span>QJsonObject tojson();
</p>
<pre class="para-block pre-indented" data-line="434" style="display:block"><code>    ~ post-&gt;json</code></pre>
<p class="p noindent para-continued" data-line="436"><span data-line="436"></span>QString post<span data-line="436"></span>_<span data-line="436"></span>id;
</p>
<pre class="para-block pre-indented" data-line="437" style="display:block"><code>    ~ 帖子id,在服务器端通过发帖人,发帖时间,所属贴页id组成字符串经过 md5 hash 生成编码32位</code></pre>
<p class="p noindent para-continued" data-line="438"><span data-line="438"></span>QString page<span data-line="438"></span>_<span data-line="438"></span>id;
</p>
<pre class="para-block pre-indented" data-line="439" style="display:block"><code>    ~ 所属贴页id，同为md5 hash 编码32位</code></pre>
<p class="p noindent para-continued" data-line="440"><span data-line="440"></span>QString usr<span data-line="440"></span>_<span data-line="440"></span>id;
</p>
<pre class="para-block pre-indented" data-line="441" style="display:block"><code>    ~ 发帖者id</code></pre>
<p class="p noindent para-continued" data-line="442"><span data-line="442"></span>QString content;
</p>
<pre class="para-block pre-indented" data-line="443" style="display:block"><code>    ~ 发帖内容</code></pre>
<p class="p noindent para-continued" data-line="444"><span data-line="444"></span>QTime time;
</p>
<pre class="para-block pre-indented" data-line="445" style="display:block"><code>    ~ 发帖时间</code></pre>
<p class="p noindent para-continued" data-line="446"><span data-line="446"></span>long long upvotes;
</p>
<pre class="para-block pre-indented" data-line="447" style="display:block"><code>    ~ 赞同数</code></pre>
<p class="p noindent para-continued" data-line="448"><span data-line="448"></span>long long downvotes;
</p>
<pre class="para-block pre-indented" data-line="449" style="display:block"><code>    ~ 反对数</code></pre><h4 id="sec-pagelet-" class="h3" data-line="451" data-heading-depth="3" style="display:block"><span data-line="451"></span><span class="heading-before"><span class="heading-label">5.1.4</span>.&#8194;</span><span data-line="451"></span>pagelet 贴页类</h4>
<p class="p noindent" data-line="453"><span data-line="453"></span>贴页定义及作用详见<span data-line="453"></span><a href="#pagelet" title="3.1.3.&#8194;贴页(pagelet)" class="localref" style="target-element:h3"><span class="heading-label">3.1.3</span></a><span data-line="453"></span>
</p>
<p class="p indent" data-line="455"><span data-line="455"></span>pagelet();
</p>
<pre class="para-block pre-indented" data-line="456" style="display:block"><code>    ~ 构造函数</code></pre>
<p class="p noindent para-continued" data-line="457"><span data-line="457"></span>pagelet(QString pagelet<span data-line="457"></span>_<span data-line="457"></span>id,QString board<span data-line="457"></span>_<span data-line="457"></span>id,QString starter<span data-line="457"></span>_<span data-line="457"></span>id,QString title,QTime time);
</p>
<pre class="para-block pre-indented" data-line="458" style="display:block"><code>    ~ 构造函数重载</code></pre>
<p class="p noindent para-continued" data-line="459"><span data-line="459"></span>pagelet(QJsonObject json);
</p>
<pre class="para-block pre-indented" data-line="460" style="display:block"><code>    ~ 构造函数重载  json-&gt;pagelet</code></pre>
<p class="p noindent para-continued" data-line="461"><span data-line="461"></span>QJsonObject tojson();
</p>
<pre class="para-block pre-indented" data-line="462" style="display:block"><code>    ~ pagelet-&gt;json</code></pre>
<p class="p noindent para-continued" data-line="464"><span data-line="464"></span>QString pagelet<span data-line="464"></span>_<span data-line="464"></span>id;
</p>
<pre class="para-block pre-indented" data-line="465" style="display:block"><code>    ~ 贴页id,在服务器端通过贴页发起者,发帖时间,所属版块id组成字符串经过 md5 hash 生成编码32位</code></pre>
<p class="p noindent para-continued" data-line="466"><span data-line="466"></span>QString board<span data-line="466"></span>_<span data-line="466"></span>id;
</p>
<pre class="para-block pre-indented" data-line="467" style="display:block"><code>    ~ 版块id</code></pre>
<p class="p noindent para-continued" data-line="468"><span data-line="468"></span>QString starter<span data-line="468"></span>_<span data-line="468"></span>id;
</p>
<pre class="para-block pre-indented" data-line="469" style="display:block"><code>    ~ 贴页发起者</code></pre>
<p class="p noindent para-continued" data-line="470"><span data-line="470"></span>QString title;
</p>
<pre class="para-block pre-indented" data-line="471" style="display:block"><code>    ~ 贴页标题</code></pre>
<p class="p noindent para-continued" data-line="472"><span data-line="472"></span>QTime time;
</p>
<pre class="para-block pre-indented" data-line="473" style="display:block"><code>    ~ 发帖时间</code></pre><h4 id="sec-board" class="h3" data-line="475" data-heading-depth="3" style="display:block"><span data-line="475"></span><span class="heading-before"><span class="heading-label">5.1.5</span>.&#8194;</span><span data-line="475"></span>board</h4>
<p class="p noindent" data-line="476"><span data-line="476"></span>board();
</p>
<pre class="para-block pre-indented" data-line="477" style="display:block"><code>    ~ 构造函数</code></pre>
<p class="p noindent para-continued" data-line="478"><span data-line="478"></span>board(QString,QString);
</p>
<pre class="para-block pre-indented" data-line="479" style="display:block"><code>    ~ 构造函数重载</code></pre>
<p class="p noindent para-continued" data-line="480"><span data-line="480"></span>board(QJsonObject);
</p>
<pre class="para-block pre-indented" data-line="481" style="display:block"><code>    ~ 构造函数重载,json-&gt;board</code></pre>
<p class="p noindent para-continued" data-line="482"><span data-line="482"></span>QJsonObject tojson();
</p>
<pre class="para-block pre-indented" data-line="483" style="display:block"><code>    ~ board-&gt;json</code></pre>
<p class="p noindent para-continued" data-line="485"><span data-line="485"></span>QString name;
</p>
<pre class="para-block pre-indented" data-line="486" style="display:block"><code>    ~ 版块id,即版块id</code></pre>
<p class="p noindent para-continued" data-line="487"><span data-line="487"></span>QString manager<span data-line="487"></span>_<span data-line="487"></span>id;
</p>
<pre class="para-block pre-indented" data-line="488" style="display:block"><code>    ~ 版主id</code></pre><h3 id="section" class="h2" data-line="492" data-heading-depth="2" style="display:block"><span data-line="492"></span><span class="heading-before"><span class="heading-label">5.2</span>.&#8194;</span><span data-line="492"></span>客户端</h3>
<p class="p noindent" data-line="493"><span data-line="493"></span>客户端由三部分组成
        <span data-line="494"></span><em class="em-star1"> 数据结构，见<a href="#datastruct" title="5.1.&#8194;数据结构" class="localref" style="target-element:h2"><span class="heading-label">5.1</span></a>
        </em><span data-line="495"></span> 前端类,负责信息的显示与收集
        <span data-line="496"></span>*<span data-line="496"></span> 控制类<span data-line="496"></span><code class="code code1">client</code><span data-line="496"></span>,负责与服务端进行交互
</p><h4 id="section" class="h3" data-line="499" data-heading-depth="3" style="display:block"><span data-line="499"></span><span class="heading-before"><span class="heading-label">5.2.1</span>.&#8194;</span><span data-line="499"></span>前端</h4>
<p class="p noindent" data-line="500"><span data-line="500"></span>前端涉及各类如下:
</p>
<p class="p indent" data-line="502"><span data-line="502"></span>loginUi
</p>
<pre class="para-block pre-indented" data-line="503" style="display:block"><code>    ~登录Ui类</code></pre>
<p class="p noindent para-continued" data-line="504"><span data-line="504"></span>signupUi
</p>
<pre class="para-block pre-indented" data-line="505" style="display:block"><code>    ~注册Ui类</code></pre>
<p class="p noindent para-continued" data-line="506"><span data-line="506"></span>mainwin
</p>
<pre class="para-block pre-indented" data-line="507" style="display:block"><code>    ~主窗口Ui类</code></pre>
<p class="p noindent para-continued" data-line="508"><span data-line="508"></span>tabUi
</p>
<pre class="para-block pre-indented" data-line="509" style="display:block"><code>    ~页Ui类</code></pre>
<p class="p noindent para-continued" data-line="510"><span data-line="510"></span>homepageUi
</p>
<pre class="para-block pre-indented" data-line="511" style="display:block"><code>    ~主页Ui类</code></pre>
<p class="p noindent para-continued" data-line="512"><span data-line="512"></span>hpmainUi
</p>
<pre class="para-block pre-indented" data-line="513" style="display:block"><code>    ~主页正文Ui类</code></pre>
<p class="p noindent para-continued" data-line="514"><span data-line="514"></span>pageUi
</p>
<pre class="para-block pre-indented" data-line="515" style="display:block"><code>    ~帖页Ui类</code></pre>
<p class="p noindent para-continued" data-line="516"><span data-line="516"></span>postUi
</p>
<pre class="para-block pre-indented" data-line="517" style="display:block"><code>    ~贴字Ui类</code></pre>
<p class="p noindent para-continued" data-line="518"><span data-line="518"></span>commentpostUi
</p>
<pre class="para-block pre-indented" data-line="519" style="display:block"><code>    ~评论框Ui类</code></pre>
<p class="p noindent para-continued" data-line="520"><span data-line="520"></span>userlistUi
</p>
<pre class="para-block pre-indented" data-line="521" style="display:block"><code>    ~用户列表页Ui类</code></pre>
<p class="p noindent para-continued" data-line="522"><span data-line="522"></span>usrlsitmainUi
</p>
<pre class="para-block pre-indented" data-line="523" style="display:block"><code>    ~用户列表正文去Ui类</code></pre>
<p class="p noindent para-continued" data-line="524"><span data-line="524"></span>promotebmUi
</p>
<pre class="para-block pre-indented" data-line="525" style="display:block"><code>    ~更改权限Ui类</code></pre>
<p class="p noindent para-continued" data-line="526"><span data-line="526"></span>settingUi
</p>
<pre class="para-block pre-indented" data-line="527" style="display:block"><code>    ~更改用户信息Ui类</code></pre><h4 id="front" class="h3" data-line="529" data-heading-depth="3" style="display:block"><span data-line="529"></span><span class="heading-before"><span class="heading-label">5.2.2</span>.&#8194;</span><span data-line="529"></span>前端的继承与多态</h4>
<p class="p noindent" data-line="531"><span data-line="531"></span>在使用Qt的过程中,前端的各种类间的调用往往比后端的逻辑更为复杂与繁琐.于是,将面向对象的方法运用与前端,极大地提高了开发前端的效率,提高了程序的可扩展性.
</p>
<p class="p indent" data-line="533"><span data-line="533"></span>在诸多的前端类中,<span data-line="533"></span><strong class="strong-star2">tabUi类</strong><span data-line="533"></span>格外的重要.<span data-line="533"></span><code class="code code1">tabUi</code><span data-line="533"></span>类为所有页类的父类.<span data-line="533"></span><code class="code code1">mainwin</code><span data-line="533"></span>类对<span data-line="533"></span><code class="code code1">tabUi</code><span data-line="533"></span>类的添加与管理,实现了浏览器式的前端效果
</p>
<p class="p indent" data-line="535"><span data-line="535"></span><code class="code code1">tabUi</code><span data-line="535"></span>的成员,从宏观上讲实现了顶部黑色条的状态栏及其功能,并规划好底部的正文区.其他子类页,只需要<span data-line="535"></span><strong class="strong-star2">继承</strong><span data-line="535"></span>tabUi,为其正文区添加内容即可.
</p>
<p class="p indent" data-line="537"><span data-line="537"></span><code class="code code1">tabUi</code><span data-line="537"></span>留了一个虚函数<span data-line="537"></span><code class="code code1">refresh</code><span data-line="537"></span>实现多态:各个子类各自实现各自的刷新页面功能.
</p><h4 id="section" class="h3" data-line="539" data-heading-depth="3" style="display:block"><span data-line="539"></span><span class="heading-before"><span class="heading-label">5.2.3</span>.&#8194;</span><span data-line="539"></span>前端类用户友好体现</h4>
<ol class="ol compact" data-line="541">
<li class="li ol-li compact-li" data-line="541"><span data-line="541"></span>浏览器式界面
</li>
<li class="li ol-li compact-li" data-line="542"><span data-line="542"></span>所有的输入框均有后端验证,并给予用户以提示
</li>
<li class="li ol-li compact-li" data-line="543"><span data-line="543"></span>支持刷新功能,可以不用重新关闭打开即可刷新数据.
</li>
<li class="li ol-li compact-li" data-line="544"><span data-line="544"></span>支持批量功能,可以批量删除选中.支持Yes to All,No to all
</li>
<li class="li ol-li compact-li" data-line="545"><span data-line="545"></span>评论区支持快速<span data-line="545"></span><code class="code code1">@</code><span data-line="545"></span>某用户功能
</li>
<li class="li ol-li compact-li" data-line="546"><span data-line="546"></span>风格模仿Github,界面清晰流畅,功能便捷齐全.
</li></ol>
<h4 id="sec-client" class="h3" data-line="548" data-heading-depth="3" style="display:block"><span data-line="548"></span><span class="heading-before"><span class="heading-label">5.2.4</span>.&#8194;</span><span data-line="548"></span>client控制类实现</h4>
<p class="p noindent" data-line="550"><span data-line="550"></span>private:
</p>
<p class="p indent" data-line="552"><span data-line="552"></span>userinfo usr;
</p>
<pre class="para-block pre-indented" data-line="553" style="display:block"><code>    ~用户信息, 本地不保存密码</code></pre>
<p class="p noindent para-continued" data-line="554"><span data-line="554"></span>QMap<span data-line="554"></span><<span data-line="554"></span>QString,QVector<span data-line="554"></span><<span data-line="554"></span>pagelet<span data-line="554"></span>&gt;<span data-line="554"></span>&gt;<span data-line="554"></span> homepage;
</p>
<pre class="para-block pre-indented" data-line="555" style="display:block"><code>    ~主页信息</code></pre>
<p class="p noindent para-continued" data-line="556"><span data-line="556"></span>QString cookie;
</p>
<pre class="para-block pre-indented" data-line="557" style="display:block"><code>    ~存储cookie</code></pre>
<p class="p noindent para-continued" data-line="558"><span data-line="558"></span>QTcpSocket <span data-line="558"></span>*<span data-line="558"></span>tcp;
</p>
<pre class="para-block pre-indented" data-line="559" style="display:block"><code>    ~链接</code></pre>
<p class="p noindent para-continued" data-line="561"><span data-line="561"></span>public:
</p>
<p class="p indent" data-line="563"><span data-line="563"></span>userinfo <span data-line="563"></span>*<span data-line="563"></span> getinfo();
</p>
<pre class="para-block pre-indented" data-line="564" style="display:block"><code>    ~ 获取用户信息</code></pre>
<p class="p noindent para-continued" data-line="565"><span data-line="565"></span>QMap<span data-line="565"></span><<span data-line="565"></span>QString,QVector<span data-line="565"></span><<span data-line="565"></span>pagelet<span data-line="565"></span>&gt;<span data-line="565"></span>&gt;<span data-line="565"></span> <span data-line="565"></span>*<span data-line="565"></span>gethomepage();
</p>
<pre class="para-block pre-indented" data-line="566" style="display:block"><code>    ~ 获取主页</code></pre>
<p class="p noindent para-continued" data-line="567"><span data-line="567"></span>bool guestin();
</p>
<pre class="para-block pre-indented" data-line="568" style="display:block"><code>    ~ 游客登录</code></pre>
<p class="p noindent para-continued" data-line="569"><span data-line="569"></span>int login(QString,QString);
</p>
<pre class="para-block pre-indented" data-line="570" style="display:block"><code>    ~ 登录</code></pre>
<p class="p noindent para-continued" data-line="571"><span data-line="571"></span>int  signup (QString usr, QString, QString;
</p>
<pre class="para-block pre-indented" data-line="572" style="display:block"><code>    ~ 注册</code></pre>
<p class="p noindent para-continued" data-line="573"><span data-line="573"></span>int signupusrcheck(QString);
</p>
<pre class="para-block pre-indented" data-line="574" style="display:block"><code>    ~ 注册时用户名验证</code></pre>
<p class="p noindent para-continued" data-line="575"><span data-line="575"></span>int signupemailcheck(QString email);
</p>
<pre class="para-block pre-indented" data-line="576" style="display:block"><code>    ~ 注册时邮箱验证</code></pre>
<p class="p noindent para-continued" data-line="577"><span data-line="577"></span>int signuppwdcheck(QString pwd);
</p>
<pre class="para-block pre-indented" data-line="578" style="display:block"><code>    ~ 注册时密码验证</code></pre>
<p class="p noindent para-continued" data-line="579"><span data-line="579"></span>void updatehomepage();
</p>
<pre class="para-block pre-indented" data-line="580" style="display:block"><code>    ~ 从服务端更新首页</code></pre>
<p class="p noindent para-continued" data-line="581"><span data-line="581"></span>bool updateuser();
</p>
<pre class="para-block pre-indented" data-line="582" style="display:block"><code>    ~ 从服务端更新用户信息</code></pre>
<p class="p noindent para-continued" data-line="583"><span data-line="583"></span>QVector<span data-line="583"></span><<span data-line="583"></span>post<span data-line="583"></span>&gt;<span data-line="583"></span> getposts(QString);
</p>
<pre class="para-block pre-indented" data-line="584" style="display:block"><code>    ~ 下载帖子</code></pre>
<p class="p noindent para-continued" data-line="585"><span data-line="585"></span>QVector<span data-line="585"></span><<span data-line="585"></span>board<span data-line="585"></span>&gt;<span data-line="585"></span> getboards();
</p>
<pre class="para-block pre-indented" data-line="586" style="display:block"><code>    ~ 下载版块信息</code></pre>
<p class="p noindent para-continued" data-line="587"><span data-line="587"></span>QVector<span data-line="587"></span><<span data-line="587"></span>userinfo<span data-line="587"></span>&gt;<span data-line="587"></span> getuserlist();
</p>
<pre class="para-block pre-indented" data-line="588" style="display:block"><code>    ~ 下载用户列表</code></pre>
<p class="p noindent para-continued" data-line="589"><span data-line="589"></span>int  logout ();
</p>
<pre class="para-block pre-indented" data-line="590" style="display:block"><code>    ~ 注销</code></pre>
<p class="p noindent para-continued" data-line="591"><span data-line="591"></span>bool deleteusr(QString);
</p>
<pre class="para-block pre-indented" data-line="592" style="display:block"><code>    ~ 删除用户</code></pre>
<p class="p noindent para-continued" data-line="593"><span data-line="593"></span>int uploadpost(post p);
</p>
<pre class="para-block pre-indented" data-line="594" style="display:block"><code>    ~ 登录</code></pre>
<p class="p noindent para-continued" data-line="595"><span data-line="595"></span>bool changevote(QString post<span data-line="595"></span>_<span data-line="595"></span>id,bool up);
</p>
<pre class="para-block pre-indented" data-line="596" style="display:block"><code>    ~ 改变帖子票数</code></pre>
<p class="p noindent para-continued" data-line="597"><span data-line="597"></span>int createpage(pagelet,post);
</p>
<pre class="para-block pre-indented" data-line="598" style="display:block"><code>    ~ 创建新的帖页</code></pre>
<p class="p noindent para-continued" data-line="599"><span data-line="599"></span>int deletepage(QString);
</p>
<pre class="para-block pre-indented" data-line="600" style="display:block"><code>    ~ 删除贴页</code></pre>
<p class="p noindent para-continued" data-line="601"><span data-line="601"></span>int changebm(QString board,QString usr);
</p>
<pre class="para-block pre-indented" data-line="602" style="display:block"><code>    ~ 改换版主</code></pre>
<p class="p noindent para-continued" data-line="603"><span data-line="603"></span>int changepw(QString oldpwd,QString newpwd;
</p>
<pre class="para-block pre-indented" data-line="604" style="display:block"><code>    ~ 改换密码</code></pre>
<p class="p noindent para-continued" data-line="605"><span data-line="605"></span>int changeag(QDate,int);//change age andgender
</p>
<pre class="para-block pre-indented" data-line="606" style="display:block"><code>    ~ 改换年龄,性别</code></pre>
<p class="p noindent para-continued" data-line="607"><span data-line="607"></span>QJsonObject callback(QJsonObject json);
</p>
<pre class="para-block pre-indented" data-line="608" style="display:block"><code>    ~ 发送请求,接受响应</code></pre><h3 id="section" class="h2" data-line="610" data-heading-depth="2" style="display:block"><span data-line="610"></span><span class="heading-before"><span class="heading-label">5.3</span>.&#8194;</span><span data-line="610"></span>服务端</h3><h4 id="section" class="h3" data-line="612" data-heading-depth="3" style="display:block"><span data-line="612"></span><span class="heading-before"><span class="heading-label">5.3.1</span>.&#8194;</span><span data-line="612"></span>数据库</h4>
<p class="p noindent" data-line="613"><span data-line="613"></span>服务端负责与数据库交互.数据库采用内存数据库<span data-line="613"></span><em class="em-star1">容器</em><span data-line="613"></span>+磁盘数据库<span data-line="613"></span><em class="em-star1">SQlite</em><span data-line="613"></span>两种.其机制与优势详见<span data-line="613"></span><a href="#database" title="4.5.&#8194;磁盘数据库/内存数据库模型" class="localref" style="target-element:h2"><span class="heading-label">4.5</span></a><span data-line="613"></span>.相关函数如下:
</p>
<p class="p indent" data-line="615"><span data-line="615"></span>void initdatabase();
</p>
<pre class="para-block pre-indented" data-line="616" style="display:block"><code>    ~初始化数据库.由于单例模式,只需要一次登入数据库.若第一次运行服务端,数据库不存在,则自动生成默认数据库,写入root权限</code></pre>
<p class="p noindent para-continued" data-line="617"><span data-line="617"></span>void loaduserinfos();
</p>
<pre class="para-block pre-indented" data-line="618" style="display:block"><code>    ~读取sqlite中users表到users容器</code></pre>
<p class="p noindent para-continued" data-line="619"><span data-line="619"></span>void loadposts();
</p>
<pre class="para-block pre-indented" data-line="620" style="display:block"><code>    ~按时间排序,读取sqlite中posts表到posts容器</code></pre>
<p class="p noindent para-continued" data-line="621"><span data-line="621"></span>void loadpagelets();
</p>
<pre class="para-block pre-indented" data-line="622" style="display:block"><code>    ~按时间排序,读取sqlite中pagelets表到users容器</code></pre>
<p class="p noindent para-continued" data-line="623"><span data-line="623"></span>void loadboard();
</p>
<pre class="para-block pre-indented" data-line="624" style="display:block"><code>    ~读取sqlite中boards表到boards容器</code></pre>
<p class="p noindent para-continued" data-line="625"><span data-line="625"></span>void replacebase();
</p>
<pre class="para-block pre-indented" data-line="626" style="display:block"><code>    ~更新sqlite数据库</code></pre>
<p class="p noindent para-continued" data-line="627"><span data-line="627"></span>server <span data-line="627"></span>&lt;<span data-line="627"></span>&lt;<span data-line="627"></span> user/post/pagelet/board
</p>
<pre class="para-block pre-indented" data-line="628" style="display:block"><code>    ~实现运算符&lt;&lt;重载,极大地方便了对于数据库的读取操作.</code></pre><h4 id="section" class="h3" data-line="630" data-heading-depth="3" style="display:block"><span data-line="630"></span><span class="heading-before"><span class="heading-label">5.3.2</span>.&#8194;</span><span data-line="630"></span>服务端窗口</h4>
<p class="p noindent" data-line="632"><span data-line="632"></span>fakedialog类负责显示当前服务端Console.具备以下功能:
</p>
<ol class="ol compact" data-line="634">
<li class="li ol-li compact-li" data-line="634"><span data-line="634"></span>显示当前用户人数
</li>
<li class="li ol-li compact-li" data-line="635"><span data-line="635"></span>显示新建链接与断开链接的socketid
</li>
<li class="li ol-li compact-li" data-line="636"><span data-line="636"></span>显示某socketid与其发送的请求json字符串
</li>
<li class="li ol-li compact-li" data-line="637"><span data-line="637"></span>显示应答json字符串
</li>
<li class="li ol-li compact-li" data-line="638"><span data-line="638"></span>(可拓展选项),将以上显示信息存为log日志文件
</li>
<li class="li ol-li compact-li" data-line="639"><span data-line="639"></span>选择关闭服务器
</li></ol>

<p class="p noindent" data-line="641"><span data-line="641"></span>server类signals:
  <span data-line="642"></span><br>
<span data-line="643"></span>void print(QString);
</p>
<pre class="para-block pre-indented" data-line="644" style="display:block"><code>    ~console打印信号</code></pre>
<p class="p noindent para-continued" data-line="645"><span data-line="645"></span>void connum(int);
</p>
<pre class="para-block pre-indented" data-line="646" style="display:block"><code>    ~更新在线人数信号</code></pre><h4 id="sec-cookiesession" class="h3" data-line="649" data-heading-depth="3" style="display:block"><span data-line="649"></span><span class="heading-before"><span class="heading-label">5.3.3</span>.&#8194;</span><span data-line="649"></span>cookie/session</h4>
<p class="p noindent" data-line="650"><span data-line="650"></span>void sessionadd (userinfo<span data-line="650"></span>*<span data-line="650"></span>);
</p>
<pre class="para-block pre-indented" data-line="651" style="display:block"><code>    ~ 将用户信息存入session,若用户存在则更新session</code></pre>
<p class="p noindent para-continued" data-line="652"><span data-line="652"></span>userinfo <span data-line="652"></span>*<span data-line="652"></span> cookie2usr(QString cookie)
</p>
<pre class="para-block pre-indented" data-line="653" style="display:block"><code>    ~ 通过cookie得到用户信息</code></pre><h4 id="section" class="h3" data-line="656" data-heading-depth="3" style="display:block"><span data-line="656"></span><span class="heading-before"><span class="heading-label">5.3.4</span>.&#8194;</span><span data-line="656"></span>服务器接收应答请求</h4>
<p class="p noindent" data-line="658"><span data-line="658"></span><strong class="strong-star2">private slots:</strong><span data-line="658"></span>
</p>
<p class="p indent" data-line="660"><span data-line="660"></span>void newConnect();
</p>
<pre class="para-block pre-indented" data-line="661" style="display:block"><code>    ~接收新连接信号槽,tcpsocket绑定</code></pre>
<p class="p noindent para-continued" data-line="662"><span data-line="662"></span>void disconnect(int);
</p>
<pre class="para-block pre-indented" data-line="663" style="display:block"><code>    ~断开链接信号槽,通过map与tcpsocket绑定</code></pre>
<p class="p noindent para-continued" data-line="664"><span data-line="664"></span>void readMsg(int);
</p>
<pre class="para-block pre-indented" data-line="665" style="display:block"><code>    ~读取信息信号槽,通过map与tcpsocket绑定</code></pre>
<p class="p noindent para-continued" data-line="667"><span data-line="667"></span><strong class="strong-star2">private:</strong><span data-line="667"></span>
</p>
<p class="p indent" data-line="669"><span data-line="669"></span>void inittcpserver();
</p>
<pre class="para-block pre-indented" data-line="670" style="display:block"><code>    ~初始化tcpserver,初始化tcpsocket容器,开始监听端口</code></pre>
<p class="p noindent para-continued" data-line="671"><span data-line="671"></span>void connumfresh();
</p>
<pre class="para-block pre-indented" data-line="672" style="display:block"><code>    ~ 更新人数</code></pre>
<p class="p noindent para-continued" data-line="674"><span data-line="674"></span><strong class="strong-star2">public:</strong><span data-line="674"></span>
</p>
<p class="p indent" data-line="676"><span data-line="676"></span>QJsonObject login(QJsonObject);
</p>
<pre class="para-block pre-indented" data-line="677" style="display:block"><code>    ~ 处理登录请求</code></pre>
<p class="p noindent para-continued" data-line="678"><span data-line="678"></span>QJsonObject signup(QJsonObject);
</p>
<pre class="para-block pre-indented" data-line="679" style="display:block"><code>    ~ 处理注册请求</code></pre>
<p class="p noindent para-continued" data-line="680"><span data-line="680"></span>QJsonObject signupusrcheck(QJsonObject);
</p>
<pre class="para-block pre-indented" data-line="681" style="display:block"><code>    ~ 处理注册用户名检测请求</code></pre>
<p class="p noindent para-continued" data-line="682"><span data-line="682"></span>QJsonObject signuppwdcheck(QJsonObject);
</p>
<pre class="para-block pre-indented" data-line="683" style="display:block"><code>    ~ 处理注册密码检测请求</code></pre>
<p class="p noindent para-continued" data-line="684"><span data-line="684"></span>QJsonObject signupemailcheck(QJsonObject);
</p>
<pre class="para-block pre-indented" data-line="685" style="display:block"><code>    ~ 处理注册邮件格式检测请求</code></pre>
<p class="p noindent para-continued" data-line="686"><span data-line="686"></span>QJsonObject gethomepage();
</p>
<pre class="para-block pre-indented" data-line="687" style="display:block"><code>    ~ 处理获取主页请求</code></pre>
<p class="p noindent para-continued" data-line="688"><span data-line="688"></span>QJsonObject getposts(QJsonObject);
</p>
<pre class="para-block pre-indented" data-line="689" style="display:block"><code>    ~ 处理获取帖子请求</code></pre>
<p class="p noindent para-continued" data-line="690"><span data-line="690"></span>QJsonObject getboards();
</p>
<pre class="para-block pre-indented" data-line="691" style="display:block"><code>    ~ 处理获取版块列表请求</code></pre>
<p class="p noindent para-continued" data-line="692"><span data-line="692"></span>(<span data-line="692"></span><em class="em-star1">need cookie to check right:</em><span data-line="692"></span>)
QJsonObject getdateuser(QJsonObject params);
</p>
<pre class="para-block pre-indented" data-line="694" style="display:block"><code>    ~ 处理获取用户信息请求,只能获取本用户</code></pre>
<p class="p noindent para-continued" data-line="695"><span data-line="695"></span>QJsonObject getuserlist(QJsonObject);
</p>
<pre class="para-block pre-indented" data-line="696" style="display:block"><code>    ~ 处理获取用户列表请求,只有管理员可以</code></pre>
<p class="p noindent para-continued" data-line="697"><span data-line="697"></span>QJsonObject logout(QJsonObject params);
</p>
<pre class="para-block pre-indented" data-line="698" style="display:block"><code>    ~ 处理注销请求,只注销本用户</code></pre>
<p class="p noindent para-continued" data-line="699"><span data-line="699"></span>QJsonObject deleteusr(QJsonObject params);
</p>
<pre class="para-block pre-indented" data-line="700" style="display:block"><code>    ~ 处理删除用户请求,只有管理员可以</code></pre>
<p class="p noindent para-continued" data-line="701"><span data-line="701"></span>QJsonObject uploadpost(QJsonObject params);
</p>
<pre class="para-block pre-indented" data-line="702" style="display:block"><code>    ~ 处理发帖请求,需要个人id.根据发帖人与发帖时间贴页id,生成帖子id.将帖子信息存入数据库</code></pre>
<p class="p noindent para-continued" data-line="703"><span data-line="703"></span>QJsonObject changevote(QJsonObject params);
</p>
<pre class="para-block pre-indented" data-line="704" style="display:block"><code>    ~ 处理赞同/反对请求,需要id</code></pre>
<p class="p noindent para-continued" data-line="705"><span data-line="705"></span>QJsonObject createpage(QJsonObject params);
</p>
<pre class="para-block pre-indented" data-line="706" style="display:block"><code>    ~ 处理创建贴页请求.需要个人id.根据发帖人发帖时间与版块名,生成贴页id,存储贴页</code></pre>
<p class="p noindent para-continued" data-line="707"><span data-line="707"></span>QJsonObject deletepage(QJsonObject params);
</p>
<pre class="para-block pre-indented" data-line="708" style="display:block"><code>    ~ 处理删除贴页请求.需要鉴定权限.</code></pre>
<p class="p noindent para-continued" data-line="709"><span data-line="709"></span>QJsonObject changebm(QJsonObject params);
</p>
<pre class="para-block pre-indented" data-line="710" style="display:block"><code>    ~ 处理改变版主,需要管理员权限</code></pre>
<p class="p noindent para-continued" data-line="711"><span data-line="711"></span>QJsonObject changepw(QJsonObject params);
</p>
<pre class="para-block pre-indented" data-line="712" style="display:block"><code>    ~ 处理改换密码请求,需要个人验证</code></pre>
<p class="p noindent para-continued" data-line="713"><span data-line="713"></span>QJsonObject changeag(QJsonObject params);
</p>
<pre class="para-block pre-indented" data-line="714" style="display:block"><code>    ~ 处理设置生日,性别请求,需要个人验证</code></pre><h2 id="section" class="h1" data-line="716" data-heading-depth="1" style="display:block"><span data-line="716"></span><span class="heading-before"><span class="heading-label">6</span>.&#8194;</span><span data-line="716"></span>产品迭代</h2><h3 id="section" class="h2" data-line="718" data-heading-depth="2" style="display:block"><span data-line="718"></span><span class="heading-before"><span class="heading-label">6.1</span>.&#8194;</span><span data-line="718"></span>第一代</h3>
<p class="p noindent" data-line="720"><span data-line="720"></span>登录,注册,浏览主页,发帖,删帖,评论,查看更改个人信息,任命版主,删除用户,注销,图形化等所有要求.并拓展了cookie/session等机制.充分利用继承,泛化等c++特性.
</p><h3 id="section" class="h2" data-line="722" data-heading-depth="2" style="display:block"><span data-line="722"></span><span class="heading-before"><span class="heading-label">6.2</span>.&#8194;</span><span data-line="722"></span>第二代</h3>
<p class="p noindent" data-line="724"><span data-line="724"></span>在第一版的基础上,软件内部分离client与server类,并添加SQLite数据库存储信息.对于sqlite的读取运算符重载.增添了创建新版面,选中批量删帖功能.美化了UI
</p><h3 id="section" class="h2" data-line="726" data-heading-depth="2" style="display:block"><span data-line="726"></span><span class="heading-before"><span class="heading-label">6.3</span>.&#8194;</span><span data-line="726"></span>最终版</h3>
<p class="p noindent" data-line="728"><span data-line="728"></span>在第二版基础上,分离成C端与S端,利用tcp通信,以Json格式传输数据,实现多用户注册,登录,浏览主页,发帖,删帖等所有基本功能.同时,利用cookie/session机制,创新实现了用户登录管理等功能.
</p><h2 id="section" class="h1" data-line="730" data-heading-depth="1" style="display:block"><span data-line="730"></span><span class="heading-before"><span class="heading-label">7</span>.&#8194;</span><span data-line="730"></span>感悟</h2>
<p class="p noindent" data-line="732"><span data-line="732"></span>本次大作业历时3个月,经历3个大版本更新.收获颇丰,感受到老师用心良苦.过程中有很多个第一次:
</p>
<ol class="ol compact" data-line="734">
<li class="li ol-li compact-li" data-line="734"><span data-line="734"></span>第一次使用Qt,第一次接触信号槽
</li>
<li class="li ol-li compact-li" data-line="735"><span data-line="735"></span>第一次采用单例模式写C++
</li>
<li class="li ol-li compact-li" data-line="736"><span data-line="736"></span>第一次用C++实现C/S架构,第一次使用tcpsocket
</li>
<li class="li ol-li compact-li" data-line="737"><span data-line="737"></span>第一采用面向对象写如此完整的工程.
</li></ol>

<p class="p noindent" data-line="739"><span data-line="739"></span>实验的结果:超额实现了所有提出的需求.并在系统的安全性与拓展性上做出了充分的优化.经历过重重验收的考验,与验收学长的深入讨论交流,可以说,本系统在已有的架构上,具备充分的合理性与自恰性.
</p>
<p class="p indent" data-line="741"><span data-line="741"></span>但是,前路慢慢其修远兮.随着对面向对象的理解愈加深入,对于架构方面的知识逐渐拓宽,一步步的经验的不断扩充,必须承认,如果想做一个成熟的,强大的,更利于维护,结构更为健康的论坛,还有很长的路要走.如果时间还够,可以有机会验收第4版,我将在以下几方面做出优化:
</p>
<ol class="ol compact" data-line="743">
<li class="li ol-li compact-li" data-line="743"><span data-line="743"></span>服务端类更加细化,对于各个实体,如<span data-line="743"></span><code class="code code1">user,post,pagelet</code><span data-line="743"></span>等,创建<span data-line="743"></span>*<span data-line="743"></span>.entity类和<span data-line="743"></span>*<span data-line="743"></span>.service类分别充当实体类与控制类.更加模块化.另外单独交由<span data-line="743"></span><em class="em-star1">通信类</em><span data-line="743"></span>来作tcpserver处理链接和转发回应请求,单独分出<span data-line="743"></span><em class="em-star1">数据类</em><span data-line="743"></span>与数据库进行交互
</li>
<li class="li ol-li compact-li" data-line="744"><span data-line="744"></span>服务端采用多线程的方式,提高性能
</li>
<li class="li ol-li compact-li" data-line="745"><span data-line="745"></span>服务端内存数据库改为<span data-line="745"></span><code class="code code1">Redis</code><span data-line="745"></span>等流行的内存数据库,并将增删减改等操作交由数据库完成
</li>
<li class="li ol-li compact-li" data-line="746"><span data-line="746"></span>添加系统消息与好友功能,完善帖子排名系统,与用户等级系统.
</li>
<li class="li ol-li compact-li" data-line="747"><span data-line="747"></span>优化前端界面,尽可能用<span data-line="747"></span><em class="em-star1">页</em><span data-line="747"></span>来代替Dialog,使之更加趋近于流行的网站视图
</li>
<li class="li ol-li compact-li" data-line="748"><span data-line="748"></span>提高安全性,采用https进行通信.
</li></ol>

<p class="p noindent" data-line="750"><span data-line="750"></span>时光荏苒,转眼已经是2019.愿这些宝贵的经验能助我前行.同时,感谢老师与助教的辛勤付出,愿大家都有一个美好的2019.
</p>
<div class="logomadoko" data-line="755" style="display:block;text-align:right;font-size:xx-small;margin-top:4em"><span data-line="756"></span>Created with&nbsp;<a href="https://www.madoko.net">Madoko.net</a>.</div><span data-line=""></span></div>
</body>

</html>
